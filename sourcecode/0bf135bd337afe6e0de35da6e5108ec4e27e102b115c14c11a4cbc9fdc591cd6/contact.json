{
  "address": "0x8c0d19e619b0301617671ffb77be4a5f18c70a9a",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "MarmoRelayerHelper",
  "compilerVersion": "v0.5.7+commit.6da8b019",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2019-04-02\n*/\n\npragma solidity ^0.5.7;\n\ninterface MarmoStork {\n    function reveal(address _signer) external payable;\n    function marmoOf(address _signer) external view;\n    function hash() external view returns (bytes32);\n}\n\ninterface Marmo {\n    function relayedBy(bytes32 _id) external view returns (address _relayer);\n    function relay(\n        address _implementation,\n        bytes calldata _data,\n        bytes calldata _signature\n    ) external;\n}\n\ncontract MarmoRelayerHelper {\n    bytes1 private constant CREATE2_PREFIX = byte(0xff);\n    bytes32 private hash;\n\n    MarmoStork public stork;\n\n    constructor(MarmoStork _stork) public {\n        hash = _stork.hash();\n        stork = _stork;\n    }\n\n    // Calculates the Marmo wallet for a given signer\n    // the wallet contract will be deployed in a deterministic manner\n    function _marmoOf(address _signer) internal view returns (address) {\n        // CREATE2 address\n        return address(\n            uint256(\n                keccak256(\n                    abi.encodePacked(\n                        CREATE2_PREFIX,\n                        stork,\n                        bytes32(uint256(_signer)),\n                        hash\n                    )\n                )\n            )\n        );\n    }\n    \n    function _isNotContract(address _address) internal view returns (bool v) {\n        assembly {\n            v := iszero(extcodesize(_address))\n        }\n    }\n    \n    function wasRelayed(\n        address _signer,\n        bytes32 _id\n    ) external view returns (bool) {\n        Marmo marmo = Marmo(_marmoOf(_signer));\n\n        if (_isNotContract(address(marmo))) {\n            return false;\n        }\n        \n        return marmo.relayedBy(_id) != address(0);\n    }\n    \n    function depsReady(\n        bytes calldata _data\n    ) external view returns (bool) {\n        // Retrieve inputs from data\n        (bytes memory dependency) = abi.decode(_data, (bytes));\n        return _checkDependency(dependency);\n    }\n    \n    function revealAndRelay(\n        address _signer,\n        address _implementation,\n        bytes calldata _data,\n        bytes calldata _signature\n    ) external {\n        Marmo marmo = Marmo(_marmoOf(_signer));\n\n        if (_isNotContract(address(marmo))) {\n            stork.reveal(_signer);\n        }\n        \n        marmo.relay(\n            _implementation,\n            _data,\n            _signature\n        );\n    }\n    \n    // internal\n    \n    // The dependency is a 'staticcall' to a 'target'\n    //  when the call succeeds and it does not return false, the dependency is satisfied.\n    // [160 bits (target) + n bits (data)]\n    function _checkDependency(bytes memory _dependency) internal view returns (bool result) {\n        if (_dependency.length == 0) {\n            result = true;\n        } else {\n            assembly {\n                let response := mload(0x40)\n                let success := staticcall(\n                    gas,\n                    mload(add(_dependency, 20)),\n                    add(52, _dependency),\n                    sub(mload(_dependency), 20),\n                    response,\n                    32\n                )\n\n                result := and(gt(success, 0), gt(mload(response), 0))\n            }\n        }\n    }\n}",
  "abi": "[{\"constant\":false,\"inputs\":[{\"name\":\"_signer\",\"type\":\"address\"},{\"name\":\"_implementation\",\"type\":\"address\"},{\"name\":\"_data\",\"type\":\"bytes\"},{\"name\":\"_signature\",\"type\":\"bytes\"}],\"name\":\"revealAndRelay\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_signer\",\"type\":\"address\"},{\"name\":\"_id\",\"type\":\"bytes32\"}],\"name\":\"wasRelayed\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_data\",\"type\":\"bytes\"}],\"name\":\"depsReady\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"stork\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_stork\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"}]",
  "bytecode": "608060405234801561001057600080fd5b5060405160208061067d8339810180604052602081101561003057600080fd5b5051604080517f09bd5a6000000000000000000000000000000000000000000000000000000000815290516001600160a01b038316916309bd5a60916004808301926020929190829003018186803b15801561008b57600080fd5b505afa15801561009f573d6000803e3d6000fd5b505050506040513d60208110156100b557600080fd5b5051600055600180546001600160a01b039092166001600160a01b0319909216919091179055610593806100ea6000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c80631242a1ff1461005157806320582e131461012a57806336777cb21461016a5780635515f7f6146101d8575b600080fd5b6101286004803603608081101561006757600080fd5b6001600160a01b038235811692602081013590911691810190606081016040820135600160201b81111561009a57600080fd5b8201836020820111156100ac57600080fd5b803590602001918460018302840111600160201b831117156100cd57600080fd5b919390929091602081019035600160201b8111156100ea57600080fd5b8201836020820111156100fc57600080fd5b803590602001918460018302840111600160201b8311171561011d57600080fd5b5090925090506101fc565b005b6101566004803603604081101561014057600080fd5b506001600160a01b03813516906020013561035a565b604080519115158252519081900360200190f35b6101566004803603602081101561018057600080fd5b810190602081018135600160201b81111561019a57600080fd5b8201836020820111156101ac57600080fd5b803590602001918460018302840111600160201b831117156101cd57600080fd5b509092509050610410565b6101e06104c1565b604080516001600160a01b039092168252519081900360200190f35b6000610207876104d0565b90506102128161052a565b156102815760015460408051600160e01b63c392cf410281526001600160a01b038a811660048301529151919092169163c392cf4191602480830192600092919082900301818387803b15801561026857600080fd5b505af115801561027c573d6000803e3d6000fd5b505050505b806001600160a01b031663ed3d9e1787878787876040518663ffffffff1660e01b815260040180866001600160a01b03166001600160a01b0316815260200180602001806020018381038352878782818152602001925080828437600083820152601f01601f191690910184810383528581526020019050858580828437600081840152601f19601f820116905080830192505050975050505050505050600060405180830381600087803b15801561033957600080fd5b505af115801561034d573d6000803e3d6000fd5b5050505050505050505050565b600080610366846104d0565b90506103718161052a565b1561038057600091505061040a565b60006001600160a01b0316816001600160a01b0316631dd3dd0b856040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b1580156103cf57600080fd5b505afa1580156103e3573d6000803e3d6000fd5b505050506040513d60208110156103f957600080fd5b50516001600160a01b031614159150505b92915050565b600060608383602081101561042457600080fd5b810190602081018135600160201b81111561043e57600080fd5b82018360208201111561045057600080fd5b803590602001918460018302840111600160201b8311171561047157600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509296506104b9955086945061052f9350505050565b949350505050565b6001546001600160a01b031681565b600154600054604080516001600160f81b03196020808301919091526001600160a01b0394851660601b6021830152938516603582015260558082019390935281518082039093018352607501905280519101205b919050565b3b1590565b600081516000141561054357506001610525565b60405160208160148551038560340160148701515afa90511515901515169291505056fea165627a7a723058205f186c211f756f1ee4200a3483ec4f7580f5f1e8ab8a975d7ef55c7f59d276d7002900000000000000000000000062632f870244ad9a9f74978489aafee0a859fdca",
  "constructorArguments": "00000000000000000000000062632f870244ad9a9f74978489aafee0a859fdca"
}