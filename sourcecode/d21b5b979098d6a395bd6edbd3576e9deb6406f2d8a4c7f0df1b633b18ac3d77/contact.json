{
  "address": "0x0ff1c3dd4b262a0324910a6e30caa182204d9163",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "AtomicSwap",
  "compilerVersion": "v0.4.25+commit.59dbf8f1",
  "optimization": false,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2018-09-19\n*/\n\npragma solidity ^0.4.19;\n\ncontract ERC20Basic {\n  function totalSupply() public view returns (uint256);\n  function balanceOf(address who) public view returns (uint256);\n  function transfer(address to, uint256 value) public returns (bool);\n  event Transfer(address indexed from, address indexed to, uint256 value);\n}\n\ncontract ERC20 is ERC20Basic {\n  function allowance(address owner, address spender) public view returns (uint256);\n  function transferFrom(address from, address to, uint256 value) public returns (bool);\n  function approve(address spender, uint256 value) public returns (bool);\n  event Approval(address indexed owner, address indexed spender, uint256 value);\n}\n\ncontract AtomicSwap {\n  struct Swap {\n    uint expiration;\n    address initiator;\n    address participant;\n    uint256 value;\n    bool isToken;\n    address token;\n    bool exists;\n  }\n\n  event InitiateSwap(address _initiator, address _participant, uint _expiration, bytes20 _hash, address _token, bool _isToken, uint256 _value);\n  event RedeemSwap(address indexed _participant, bytes20 indexed _hash, bytes32 _secret);\n  event RefundSwap(address _initiator, address _participant, bytes20 _hash);\n  // maps the redeemer and bytes20 hash to a swap    \n  mapping(address => mapping(bytes20 => Swap)) public swaps;\n\n  function initiate(uint _expiration, bytes20 _hash, address _participant, address _token, bool _isToken, uint256 _value) payable public {\n    Swap storage s = swaps[_participant][_hash];\n    // make sure you aren't overwriting a pre-existing swap\n    // (so the original initiator can't rewrite the terms)\n    require (s.exists == false);\n    // don't allow the creation of already expired swaps\n    require (now < _expiration);\n\n    if (_isToken) {\n      // require that the sender has allowed the tokens to be withdrawn from their account\n      ERC20 token = ERC20(_token);\n      require(token.allowance(msg.sender, this) == _value);\n      token.transferFrom(msg.sender, this, _value);\n    }\n    // create the new swap\n    swaps[_participant][_hash] = Swap(_expiration, msg.sender, _participant, _isToken ? _value : msg.value, _isToken, _token, true);\n    InitiateSwap(msg.sender, _participant, _expiration, _hash, _token, _isToken, _isToken ? _value : msg.value);\n  }\n\n  function redeem(bytes32 _secret) public {\n    // get a swap from the mapping. we can do it directly because there is no way to \n    // fake the secret.\n    bytes20 hash = ripemd160(_secret);\n    Swap storage s = swaps[msg.sender][hash];\n    \n    // make sure the swap was not redeemed or refunded\n    require(s.exists);\n    // make sure the swap did not expire already\n    require(now < s.expiration);\n    \n    // clean up and send\n    s.exists = false;\n    if (s.isToken) {\n      ERC20 token = ERC20(s.token);\n      token.transfer(msg.sender, s.value);\n    } else {\n      msg.sender.transfer(s.value);\n    }\n\n    RedeemSwap(msg.sender, hash, _secret);\n  }\n\n  function refund(bytes20 _hash, address _participant) public {\n    Swap storage s = swaps[_participant][_hash];\n    // don't allow refund if swap did not expire\n    require(now > s.expiration);\n    // don't allow refunds if the caller is not the initator\n    require(msg.sender == s.initiator);\n    // make sure the swap was not redeemed or refunded\n    require(s.exists);\n\n    s.exists = false;\n    if (s.isToken) {\n      ERC20 token = ERC20(s.token);\n      token.transfer(msg.sender, s.value);\n    } else {\n      msg.sender.transfer(s.value);\n    }\n\n    RefundSwap(msg.sender, s.participant, _hash);\n  }\n}",
  "abi": "[{\"constant\":false,\"inputs\":[{\"name\":\"_expiration\",\"type\":\"uint256\"},{\"name\":\"_hash\",\"type\":\"bytes20\"},{\"name\":\"_participant\",\"type\":\"address\"},{\"name\":\"_token\",\"type\":\"address\"},{\"name\":\"_isToken\",\"type\":\"bool\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"initiate\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"bytes20\"}],\"name\":\"swaps\",\"outputs\":[{\"name\":\"expiration\",\"type\":\"uint256\"},{\"name\":\"initiator\",\"type\":\"address\"},{\"name\":\"participant\",\"type\":\"address\"},{\"name\":\"value\",\"type\":\"uint256\"},{\"name\":\"isToken\",\"type\":\"bool\"},{\"name\":\"token\",\"type\":\"address\"},{\"name\":\"exists\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_secret\",\"type\":\"bytes32\"}],\"name\":\"redeem\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_hash\",\"type\":\"bytes20\"},{\"name\":\"_participant\",\"type\":\"address\"}],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_initiator\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_participant\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_expiration\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"_hash\",\"type\":\"bytes20\"},{\"indexed\":false,\"name\":\"_token\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_isToken\",\"type\":\"bool\"},{\"indexed\":false,\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"InitiateSwap\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_participant\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_hash\",\"type\":\"bytes20\"},{\"indexed\":false,\"name\":\"_secret\",\"type\":\"bytes32\"}],\"name\":\"RedeemSwap\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"_initiator\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_participant\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_hash\",\"type\":\"bytes20\"}],\"name\":\"RefundSwap\",\"type\":\"event\"}]",
  "bytecode": "608060405234801561001057600080fd5b5061101b806100206000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680637337c99314610067578063e2ca481c146100f6578063eda1122c1461021c578063f66c75e51461024d575b600080fd5b6100f46004803603810190808035906020019092919080356bffffffffffffffffffffffff19169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803515159060200190929190803590602001909291905050506102a9565b005b34801561010257600080fd5b50610150600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080356bffffffffffffffffffffffff191690602001909291905050506108c4565b604051808881526020018773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001858152602001841515151581526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018215151515815260200197505050505050505060405180910390f35b34801561022857600080fd5b5061024b600480360381019080803560001916906020019092919050505061098d565b005b34801561025957600080fd5b506102a760048036038101908080356bffffffffffffffffffffffff19169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610c7a565b005b6000806000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000886bffffffffffffffffffffffff19166bffffffffffffffffffffffff191681526020019081526020016000209150600015158260040160159054906101000a900460ff16151514151561033f57600080fd5b874210151561034d57600080fd5b831561058157849050828173ffffffffffffffffffffffffffffffffffffffff1663dd62ed3e33306040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050602060405180830381600087803b15801561042657600080fd5b505af115801561043a573d6000803e3d6000fd5b505050506040513d602081101561045057600080fd5b810190808051906020019092919050505014151561046d57600080fd5b8073ffffffffffffffffffffffffffffffffffffffff166323b872dd3330866040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b15801561054457600080fd5b505af1158015610558573d6000803e3d6000fd5b505050506040513d602081101561056e57600080fd5b8101908080519060200190929190505050505b60e0604051908101604052808981526020013373ffffffffffffffffffffffffffffffffffffffff1681526020018773ffffffffffffffffffffffffffffffffffffffff168152602001856105d657346105d8565b845b815260200185151581526020018673ffffffffffffffffffffffffffffffffffffffff168152602001600115158152506000808873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000896bffffffffffffffffffffffff19166bffffffffffffffffffffffff191681526020019081526020016000206000820151816000015560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506060820151816003015560808201518160040160006101000a81548160ff02191690831515021790555060a08201518160040160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060c08201518160040160156101000a81548160ff0219169083151502179055509050507fcdcddbe9ff8b399081a21b2d1e89d5ff9d445fe8fbc0b20a78c0d090503b1a5233878a8a89898a6107d357346107d5565b895b604051808873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001868152602001856bffffffffffffffffffffffff19166bffffffffffffffffffffffff191681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018315151515815260200182815260200197505050505050505060405180910390a15050505050505050565b6000602052816000526040600020602052806000526040600020600091509150508060000154908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030154908060040160009054906101000a900460ff16908060040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060040160159054906101000a900460ff16905087565b60008060006003846040518082600019166000191681526020019150506020604051808303816000865af11580156109c9573d6000803e3d6000fd5b505050604051516c010000000000000000000000000292506000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000846bffffffffffffffffffffffff19166bffffffffffffffffffffffff1916815260200190815260200160002091508160040160159054906101000a900460ff161515610a6d57600080fd5b816000015442101515610a7f57600080fd5b60008260040160156101000a81548160ff0219169083151502179055508160040160009054906101000a900460ff1615610bc2578160040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb3384600301546040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b158015610b8157600080fd5b505af1158015610b95573d6000803e3d6000fd5b505050506040513d6020811015610bab57600080fd5b810190808051906020019092919050505050610c0e565b3373ffffffffffffffffffffffffffffffffffffffff166108fc83600301549081150290604051600060405180830381858888f19350505050158015610c0c573d6000803e3d6000fd5b505b826bffffffffffffffffffffffff19163373ffffffffffffffffffffffffffffffffffffffff167fcbca3434730ae3817b50936d1dbbdf3a3a24a304e8d4239bd7601933f7c7687f8660405180826000191660001916815260200191505060405180910390a350505050565b6000806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000856bffffffffffffffffffffffff19166bffffffffffffffffffffffff191681526020019081526020016000209150816000015442111515610cfe57600080fd5b8160010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610d5c57600080fd5b8160040160159054906101000a900460ff161515610d7957600080fd5b60008260040160156101000a81548160ff0219169083151502179055508160040160009054906101000a900460ff1615610ebc578160040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb3384600301546040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b158015610e7b57600080fd5b505af1158015610e8f573d6000803e3d6000fd5b505050506040513d6020811015610ea557600080fd5b810190808051906020019092919050505050610f08565b3373ffffffffffffffffffffffffffffffffffffffff166108fc83600301549081150290604051600060405180830381858888f19350505050158015610f06573d6000803e3d6000fd5b505b7f156c8d8466f396c2a693c794d60f5e88107a49ab17056787ca821d1bac031a71338360020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1686604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001826bffffffffffffffffffffffff19166bffffffffffffffffffffffff19168152602001935050505060405180910390a1505050505600a165627a7a72305820f5674dd785a71d4f63c294f6200086382e570c4a73da0e37423abb399e2c1f5d0029"
}