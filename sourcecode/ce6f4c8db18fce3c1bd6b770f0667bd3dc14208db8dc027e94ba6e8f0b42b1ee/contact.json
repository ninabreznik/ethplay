{
  "address": "0x0094110c81183740c23d561818500ce0c8222d8b",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "Bitscreen",
  "compilerVersion": "v0.4.20+commit.3155dd80",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2018-07-14\n*/\n\npragma solidity ^0.4.0;\ncontract Bitscreen {\n\n    struct IPFSHash {\n    bytes32 hash;\n    uint8 hashFunction;\n    uint8 size;\n    }\n    event ImageChange(bytes32 _hash,uint8 _hashFunction,uint8 _size, uint _cost);\n    event PriceChange(uint price);\n    \n    struct ScreenData {\n    uint currTopBid;\n    uint currTopBidTimeStamp;\n    uint lifetimeValue; //total eth that has gone into contract (historical)\n    uint periodPercentagePriceDecrease;\n    uint PriceDecreasePeriodLengthSecs;\n    address currHolder;\n    uint8 heightRatio;\n    uint8 widthRatio;\n    string country;\n    }\n    \n\n    struct ContentRules {\n        bool sexual;\n        bool violent;\n        bool political;\n        bool controversial;\n        bool illegal; //content that goes agaisnt the law of the country it is operating in\n    }\n    \n    event RuleChange(bool _sexual,bool _violent,bool _political,bool _controversial,bool _illegal);\n\n    struct AdBuyerInfo{\n        uint numberAdBuys;\n        bool cashedOut;\n    }\n    \n    struct DividendInfo{\n        uint  activeAdBuysForDividend; //gets lowered (according to their numberAdBuys) when someone cashes out\n        uint  ownerpool;\n        uint  dividendPool;\n        mapping(address => AdBuyerInfo) adbuyerMap;\n    }\n    \n\n    //contract variables\n\n    //creator of the contract\n    address public owner;\n    \n    //total eth currently in contract\n    uint public contractValue;\n\n    //current ipfs hash \n    IPFSHash public currPicHash;\n    \n    //current state of the screen\n    ScreenData public screenstate;\n    ContentRules public rules;\n    address[] private badAddresses;\n    \n    //current dividend info\n    DividendInfo public dividendinfo;\n\n    function Bitscreen(bytes32 _ipfsHash, uint8 _ipfsHashFunc, uint8 _ipfsHashSize, uint8 _heightRatio, uint8 _widthRatio, string _country, uint _periodPercentagePriceDecrease,uint _priceDecreasePeriodLengthSecs) public {\n        owner = msg.sender;\n        currPicHash = IPFSHash(_ipfsHash,_ipfsHashFunc,_ipfsHashSize);\n        screenstate = ScreenData(0,now,0,_periodPercentagePriceDecrease,_priceDecreasePeriodLengthSecs,msg.sender,_heightRatio,_widthRatio,_country);\n        rules = ContentRules(false,false,false,false,false);\n        dividendinfo=DividendInfo(0,0,0);\n    }\n    \n\n    function withdrawOwnerAmount() external{\n        if(msg.sender == owner) { // Only let the contract creator do this\n            uint withdrawAmount = dividendinfo.ownerpool;\n            dividendinfo.ownerpool=0;\n            contractValue-=withdrawAmount;\n            msg.sender.transfer(withdrawAmount);\n        }else{\n            revert();\n        }\n    }\n    \n    \n    //request to know how much dividend you can get\n    function inquireDividentAmount()  view external returns(uint){\n        uint dividendToSend=calcuCurrTxDividend(msg.sender);\n        return dividendToSend;\n    }\n    \n    function withdrawDividend() external{\n        uint dividendToSend=calcuCurrTxDividend(msg.sender);\n        if(dividendToSend==0){\n            revert();\n        }else{\n        uint senderNumAdbuys=dividendinfo.adbuyerMap[msg.sender].numberAdBuys;\n        dividendinfo.activeAdBuysForDividend-=senderNumAdbuys;\n        dividendinfo.dividendPool-=dividendToSend;\n        contractValue-=dividendToSend;\n        dividendinfo.adbuyerMap[msg.sender].cashedOut=true;\n        dividendinfo.adbuyerMap[msg.sender].numberAdBuys=0;\n        \n        //send\n        msg.sender.transfer(dividendToSend);\n        }\n    }\n    \n    function calcuCurrTxDividend(address dividentRecepient) view private returns(uint) {\n        uint totaldividend;\n        if(dividendinfo.activeAdBuysForDividend==0 || dividendinfo.adbuyerMap[dividentRecepient].cashedOut){ \n            totaldividend=0;\n        }else{\n            totaldividend=(dividendinfo.dividendPool*dividendinfo.adbuyerMap[dividentRecepient].numberAdBuys)/(dividendinfo.activeAdBuysForDividend);\n        }\n        return totaldividend;\n    }\n    \n    function getBadAddresses() external constant returns (address[]) {\n        if(msg.sender == owner) {\n            return badAddresses;\n        }else{\n            revert();\n        }\n    }\n\n    function changeRules(bool _sexual,bool _violent, bool _political, bool _controversial, bool _illegal) public {\n                if(msg.sender == owner) {\n                rules.sexual=_sexual;\n                rules.violent=_violent;\n                rules.political=_political;\n                rules.controversial=_controversial;\n                rules.illegal=_illegal;\n                \n                RuleChange(_sexual,_violent,_political,_controversial,_illegal);\n                \n                }else{\n                revert();\n                }\n    }\n\n\n    function calculateCurrDynamicPrice() public view returns (uint){\n        uint currDynamicPrice;\n        uint periodLengthSecs=screenstate.PriceDecreasePeriodLengthSecs;\n        \n        uint ellapsedPeriodsSinceLastBid= (now - screenstate.currTopBidTimeStamp)/periodLengthSecs;\n        \n        uint totalDecrease=((screenstate.currTopBid*screenstate.periodPercentagePriceDecrease*ellapsedPeriodsSinceLastBid)/100);\n        \n        if(totalDecrease>screenstate.currTopBid){\n            currDynamicPrice=0;\n        }else{\n            currDynamicPrice= screenstate.currTopBid-totalDecrease;\n        }\n        \n        return currDynamicPrice;\n        \n    }\n\n    function truncToThreeDecimals(uint amount) private pure returns (uint){\n        return ((amount/1000000000000000)*1000000000000000);\n    }\n\n\n    function changeBid(bytes32 _ipfsHash, uint8 _ipfsHashFunc, uint8 _ipfsHashSize) payable external {\n        \n            uint dynamicPrice=calculateCurrDynamicPrice();\n        \n            if(msg.value>dynamicPrice) { //prev: msg.value>screenstate.currTopBid\n            \n                if(truncToThreeDecimals(msg.value)-truncToThreeDecimals(dynamicPrice)<1000000000000000){\n                    revert();\n                }else{\n                    \n                screenstate.currTopBid=msg.value;\n                screenstate.currTopBidTimeStamp=now;\n                screenstate.currHolder=msg.sender;\n                \n                screenstate.lifetimeValue+=msg.value;\n                contractValue+=msg.value;//total eth CURRENTLY IN contract\n                //store 33% to dividend pool, send 66% to ownerpool\n                dividendinfo.dividendPool+=msg.value/3;\n                dividendinfo.ownerpool+=((msg.value*2)/3);\n                \n                currPicHash.hash=_ipfsHash;\n                currPicHash.hashFunction=_ipfsHashFunc;\n                currPicHash.size=_ipfsHashSize;\n                \n                dividendinfo.activeAdBuysForDividend++;\n                if(dividendinfo.adbuyerMap[msg.sender].numberAdBuys==0){\n                    dividendinfo.adbuyerMap[msg.sender]=AdBuyerInfo(1,false);\n                }else{\n                    dividendinfo.adbuyerMap[msg.sender].numberAdBuys++;\n                }\n                \n                ImageChange(_ipfsHash,_ipfsHashFunc,_ipfsHashSize,screenstate.currTopBid);\n                \n                }\n                \n            }else {\n                revert();\n            }\n    }\n    \n    function emergencyOverwrite(bytes32 _ipfsHash, uint8 _ipfsHashFunc, uint8 _ipfsHashSize) external {\n        if(msg.sender == owner) { // Only let the contract creator do this\n            badAddresses.push(screenstate.currHolder);\n            currPicHash.hash=_ipfsHash;\n            currPicHash.hashFunction=_ipfsHashFunc;\n            currPicHash.size=_ipfsHashSize;\n            screenstate.currHolder=msg.sender;\n            ImageChange(_ipfsHash,_ipfsHashFunc,_ipfsHashSize,0);\n        }else{\n            revert();\n        }\n    }\n    \n    function changePriceDecreasePeriod(uint newPeriod) public{\n        require(msg.sender==owner);\n        screenstate.PriceDecreasePeriodLengthSecs=newPeriod;\n    }\n    \n    function changePriceDecreasePercent(uint newPercent) public{\n        require(msg.sender==owner);\n        screenstate.periodPercentagePriceDecrease=newPercent;\n    }\n    \n    \n    function () payable public {}\n\n}",
  "bytecode": "6060604052341561000f57600080fd5b604051610ef2380380610ef28339810160405280805191906020018051919060200180519190602001805191906020018051919060200180518201919060200180519190602001805160008054600160a060020a03191633600160a060020a0316179055915060609050604051908101604090815289825260ff808a166020840152881690820152600281518155602082015160018201805460ff191660ff9290921691909117905560408201516001909101805460ff929092166101000261ff00199092169190911790555061012060405190810160405280600081526020014281526020016000815260200183815260200182815260200133600160a060020a031681526020018660ff1681526020018560ff168152602001848152506004600082015181556020820151816001015560408201518160020155606082015181600301556080820151816004015560a0820151600582018054600160a060020a031916600160a060020a039290921691909117905560c08201518160050160146101000a81548160ff021916908360ff16021790555060e08201518160050160156101000a81548160ff021916908360ff160217905550610100820151816006019080516101e39291602001906102d6565b5090505060a06040519081016040908152600080835260208301819052908201819052606082018190526080820152600b8151815460ff1916901515178155602082015181549015156101000261ff001990911617815560408201518154901515620100000262ff0000199091161781556060820151815490151563010000000263ff00000019909116178155608082015181549015156401000000000264ff0000000019909116179055506060604051908101604090815260008083526020830181905290820152600d8151815560208201518160010155604082015181600201559050505050505050505050610371565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061031757805160ff1916838001178555610344565b82800160010185558215610344579182015b82811115610344578251825591602001919060010190610329565b50610350929150610354565b5090565b61036e91905b80821115610350576000815560010161035a565b90565b610b72806103806000396000f3006060604052600436106100e55763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166303a6c81981146100e7578063086610d2146100fd57806312bddc9c14610137578063355ba211146101635780634636db04146101855780635225528e1461019c57806352f6747a14610202578063647d5f141461024e5780636a474002146102855780638da5cb5b14610298578063922ba128146102c7578063929f11ea146102ec578063b2057a6f146102ff578063b872928014610312578063e0dec0c014610328578063f3e5c15e1461033b575b005b34156100f257600080fd5b6100e5600435610424565b341561010857600080fd5b610110610444565b60405192835260ff9182166020840152166040808301919091526060909101905180910390f35b341561014257600080fd5b6100e560043515156024351515604435151560643515156084351515610459565b341561016e57600080fd5b6100e560043560ff6024358116906044351661052d565b6100e560043560ff60243581169060443516610624565b34156101a757600080fd5b6101af6107d3565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156101ee5780820151838201526020016101d6565b505050509050019250505060405180910390f35b341561020d57600080fd5b610215610853565b604051941515855292151560208501529015156040808501919091529015156060840152901515608083015260a0909101905180910390f35b341561025957600080fd5b610261610884565b60405180848152602001838152602001828152602001935050505060405180910390f35b341561029057600080fd5b6100e5610890565b34156102a357600080fd5b6102ab610920565b604051600160a060020a03909116815260200160405180910390f35b34156102d257600080fd5b6102da61092f565b60405190815260200160405180910390f35b34156102f757600080fd5b6100e5610983565b341561030a57600080fd5b6102da6109e2565b341561031d57600080fd5b6100e56004356109f8565b341561033357600080fd5b6102da610a18565b341561034657600080fd5b61034e610a1e565b60405189815260208101899052604081018890526060810187905260808101869052600160a060020a03851660a082015260ff84811660c0830152831660e0820152610120610100808301828152845460026001821615909302600019011691909104918301829052906101408301908490801561040d5780601f106103e25761010080835404028352916020019161040d565b820191906000526020600020905b8154815290600101906020018083116103f057829003601f168201915b50509a505050505050505050505060405180910390f35b60005433600160a060020a0390811691161461043f57600080fd5b600855565b60025460035460ff8082169161010090041683565b60005433600160a060020a039081169116141561052157600b805460ff19168615151761ff001916610100861515021762ff0000191662010000851515021763ff00000019166301000000841515021764ff000000001916640100000000831515021790557fdad319721f47cead5eaf4bb86e03ec7d4e838fc918247e31dc56bbc095e43f788585858585604051941515855292151560208501529015156040808501919091529015156060840152901515608083015260a0909101905180910390a1610526565b600080fd5b5050505050565b60005433600160a060020a039081169116141561052157600c8054600181016105568382610af6565b506000918252602082206009805492909101805473ffffffffffffffffffffffffffffffffffffffff19908116600160a060020a039485161790915560028790556003805460ff8781166101000261ff0019918a1660ff19909316929092171617905581543390931692169190911790557f3abc651fe936678689121041434e970f4438593ff158dd6757243e7fd4510ab99084908490849060405193845260ff9283166020850152911660408084019190915260608301919091526080909101905180910390a15b505050565b600061062e61092f565b9050803411156105215766038d7ea4c6800061064982610a77565b61065234610a77565b03101561065e57600080fd5b346004819055426005556009805473ffffffffffffffffffffffffffffffffffffffff191633600160a060020a031690811790915560068054830190556001805483018155600f80546003808604909101909155600e8054600295860283900401905592879055825460ff8681166101000261ff001991891660ff19909316929092171617909255600d80549092019091556000908152601060205260409020541515610754576040805190810160409081526001825260006020808401829052600160a060020a03331682526010905220815181556020820151600191909101805460ff191691151591909117905550610774565b600160a060020a0333166000908152601060205260409020805460010190555b7f3abc651fe936678689121041434e970f4438593ff158dd6757243e7fd4510ab984848460046000015460405193845260ff9283166020850152911660408084019190915260608301919091526080909101905180910390a150505050565b6107db610b1a565b60005433600160a060020a039081169116141561052157600c80548060200260200160405190810160405280929190818152602001828054801561084857602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161082a575b505050505090505b90565b600b5460ff808216916101008104821691620100008204811691630100000081048216916401000000009091041685565b600d54600e54600f5483565b60008061089c33610a87565b91508115156108aa57600080fd5b50600160a060020a0333166000818152601060205260408082208054600d80548290039055600f80548790039055600180548790038155808301805460ff1916909117905592905590919083156108fc0290849051600060405180830381858888f19350505050151561091c57600080fd5b5050565b600054600160a060020a031681565b6008546005546000918291829081908390420381151561094b57fe5b60075460045492909104935060649082028402049150811115610971576000935061097a565b60045481900393505b50919392505050565b6000805433600160a060020a03908116911614156105215750600e80546000909155600180548290039055600160a060020a03331681156108fc0282604051600060405180830381858888f1935050505015156109df57600080fd5b50565b6000806109ee33610a87565b90508091505b5090565b60005433600160a060020a03908116911614610a1357600080fd5b600755565b60015481565b600454600554600654600754600854600954600160a060020a0381169060ff7401000000000000000000000000000000000000000082048116917501000000000000000000000000000000000000000000900416600a89565b66038d7ea4c68000908190040290565b600d5460009081901580610ab65750600160a060020a03831660009081526010602052604090206001015460ff165b15610ac357506000610af0565b600d54600160a060020a038416600090815260106020526040902054600f5402811515610aec57fe5b0490505b92915050565b81548183558181151161061f5760008381526020902061061f918101908301610b2c565b60206040519081016040526000815290565b61085091905b808211156109f45760008155600101610b325600a165627a7a7230582098bbecfe9f3bd8152c06fac222b570fa178ccd7131e04513eb689a65ac365bae0029bd833c7bae634f9e2e89ac798e07ac19c87bfe622fe6fba995c12a2b36d883920000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000015180000000000000000000000000000000000000000000000000000000000000000343414e0000000000000000000000000000000000000000000000000000000000",
  "constructorArguments": "bd833c7bae634f9e2e89ac798e07ac19c87bfe622fe6fba995c12a2b36d883920000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000015180000000000000000000000000000000000000000000000000000000000000000343414e0000000000000000000000000000000000000000000000000000000000"
}