{
  "address": "0x00000000e82eb0431756271f0d00cfb143685e7b",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "MetamorphicContractFactory",
  "compilerVersion": "v0.5.6+commit.b259423e",
  "optimization": true,
  "runs": "999",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2019-04-07\n*/\n\npragma solidity 0.5.6;\n\n\n/**\n * @title Metamorphic Contract Factory\n * @author 0age\n * @notice This contract creates metamorphic contracts, or contracts that can be\n * redeployed with new code to the same address. It does so by deploying a\n * contract with fixed, non-deterministic initialization code via the CREATE2\n * opcode. This contract clones the implementation contract in its constructor.\n * Once a contract undergoes metamorphosis, all existing storage will be deleted\n * and any existing contract code will be replaced with the deployed contract\n * code of the new implementation contract.\n * @dev CREATE2 will not be available on mainnet until (at least) block\n * 7,280,000. This contract has not yet been fully tested or audited - proceed\n * with caution and please share any exploits or optimizations you discover.\n */\ncontract MetamorphicContractFactory {\n  // fires when a metamorphic contract is deployed by cloning another contract.\n  event Metamorphosed(address metamorphicContract, address newImplementation);\n  \n  // fires when a metamorphic contract is deployed through a transient contract.\n  event MetamorphosedWithConstructor(\n    address metamorphicContract,\n    address transientContract\n  );\n\n  // store the initialization code for metamorphic contracts.\n  bytes private _metamorphicContractInitializationCode;\n\n  // store hash of the initialization code for metamorphic contracts as well.\n  bytes32 private _metamorphicContractInitializationCodeHash;\n\n  // store init code for transient contracts that deploy metamorphic contracts.\n  bytes private _transientContractInitializationCode;\n\n  // store the hash of the initialization code for transient contracts as well.\n  bytes32 private _transientContractInitializationCodeHash;\n\n  // maintain a mapping of metamorphic contracts to metamorphic implementations.\n  mapping(address => address) private _implementations;\n\n  // maintain a mapping of transient contracts to metamorphic init codes.\n  mapping(address => bytes) private _initCodes;\n\n  /**\n   * @dev In the constructor, set up the initialization code for metamorphic\n   * contracts as well as the keccak256 hash of the given initialization code.\n   * @param transientContractInitializationCode bytes The initialization code\n   * that will be used to deploy any transient contracts, which will deploy any\n   * metamorphic contracts that require the use of a constructor.\n   * \n   * Metamorphic contract initialization code (29 bytes): \n   *\n   *       0x5860208158601c335a63aaf10f428752fa158151803b80938091923cf3\n   *\n   * Description:\n   *\n   * pc|op|name         | [stack]                                | <memory>\n   *\n   * ** set the first stack item to zero - used later **\n   * 00 58 getpc          [0]                                       <>\n   *\n   * ** set second stack item to 32, length of word returned from staticcall **\n   * 01 60 push1\n   * 02 20 outsize        [0, 32]                                   <>\n   *\n   * ** set third stack item to 0, position of word returned from staticcall **\n   * 03 81 dup2           [0, 32, 0]                                <>\n   *\n   * ** set fourth stack item to 4, length of selector given to staticcall **\n   * 04 58 getpc          [0, 32, 0, 4]                             <>\n   *\n   * ** set fifth stack item to 28, position of selector given to staticcall **\n   * 05 60 push1\n   * 06 1c inpos          [0, 32, 0, 4, 28]                         <>\n   *\n   * ** set the sixth stack item to msg.sender, target address for staticcall **\n   * 07 33 caller         [0, 32, 0, 4, 28, caller]                 <>\n   *\n   * ** set the seventh stack item to msg.gas, gas to forward for staticcall **\n   * 08 5a gas            [0, 32, 0, 4, 28, caller, gas]            <>\n   *\n   * ** set the eighth stack item to selector, \"what\" to store via mstore **\n   * 09 63 push4\n   * 10 aaf10f42 selector [0, 32, 0, 4, 28, caller, gas, 0xaaf10f42]    <>\n   *\n   * ** set the ninth stack item to 0, \"where\" to store via mstore ***\n   * 11 87 dup8           [0, 32, 0, 4, 28, caller, gas, 0xaaf10f42, 0] <>\n   *\n   * ** call mstore, consume 8 and 9 from the stack, place selector in memory **\n   * 12 52 mstore         [0, 32, 0, 4, 0, caller, gas]             <0xaaf10f42>\n   *\n   * ** call staticcall, consume items 2 through 7, place address in memory **\n   * 13 fa staticcall     [0, 1 (if successful)]                    <address>\n   *\n   * ** flip success bit in second stack item to set to 0 **\n   * 14 15 iszero         [0, 0]                                    <address>\n   *\n   * ** push a third 0 to the stack, position of address in memory **\n   * 15 81 dup2           [0, 0, 0]                                 <address>\n   *\n   * ** place address from position in memory onto third stack item **\n   * 16 51 mload          [0, 0, address]                           <>\n   *\n   * ** place address to fourth stack item for extcodesize to consume **\n   * 17 80 dup1           [0, 0, address, address]                  <>\n   *\n   * ** get extcodesize on fourth stack item for extcodecopy **\n   * 18 3b extcodesize    [0, 0, address, size]                     <>\n   *\n   * ** dup and swap size for use by return at end of init code **\n   * 19 80 dup1           [0, 0, address, size, size]               <> \n   * 20 93 swap4          [size, 0, address, size, 0]               <>\n   *\n   * ** push code position 0 to stack and reorder stack items for extcodecopy **\n   * 21 80 dup1           [size, 0, address, size, 0, 0]            <>\n   * 22 91 swap2          [size, 0, address, 0, 0, size]            <>\n   * 23 92 swap3          [size, 0, size, 0, 0, address]            <>\n   *\n   * ** call extcodecopy, consume four items, clone runtime code to memory **\n   * 24 3c extcodecopy    [size, 0]                                 <code>\n   *\n   * ** return to deploy final code in memory **\n   * 25 f3 return         []                                        *deployed!*\n   *\n   *\n   * Transient contract initialization code derived from TransientContract.sol.\n   */\n  constructor(bytes memory transientContractInitializationCode) public {\n    // assign the initialization code for the metamorphic contract.\n    _metamorphicContractInitializationCode = (\n      hex\"5860208158601c335a63aaf10f428752fa158151803b80938091923cf3\"\n    );\n\n    // calculate and assign keccak256 hash of metamorphic initialization code.\n    _metamorphicContractInitializationCodeHash = keccak256(\n      abi.encodePacked(\n        _metamorphicContractInitializationCode\n      )\n    );\n\n    // store the initialization code for the transient contract.\n    _transientContractInitializationCode = transientContractInitializationCode;\n\n    // calculate and assign keccak256 hash of transient initialization code.\n    _transientContractInitializationCodeHash = keccak256(\n      abi.encodePacked(\n        _transientContractInitializationCode\n      )\n    );\n  }\n\n  /* solhint-disable function-max-lines */\n  /**\n   * @dev Deploy a metamorphic contract by submitting a given salt or nonce\n   * along with the initialization code for the metamorphic contract, and\n   * optionally provide calldata for initializing the new metamorphic contract.\n   * To replace the contract, first selfdestruct the current contract, then call\n   * with the same salt value and new initialization code (be aware that all\n   * existing state will be wiped from the existing contract). Also note that\n   * the first 20 bytes of the salt must match the calling address, which\n   * prevents contracts from being created by unintended parties.\n   * @param salt bytes32 The nonce that will be passed into the CREATE2 call and\n   * thus will determine the resulant address of the metamorphic contract.\n   * @param implementationContractInitializationCode bytes The initialization\n   * code for the implementation contract for the metamorphic contract. It will\n   * be used to deploy a new contract that the metamorphic contract will then\n   * clone in its constructor.\n   * @param metamorphicContractInitializationCalldata bytes An optional data\n   * parameter that can be used to atomically initialize the metamorphic\n   * contract.\n   * @return Address of the metamorphic contract that will be created.\n   */\n  function deployMetamorphicContract(\n    bytes32 salt,\n    bytes calldata implementationContractInitializationCode,\n    bytes calldata metamorphicContractInitializationCalldata\n  ) external payable containsCaller(salt) returns (\n    address metamorphicContractAddress\n  ) {\n    // move implementation init code and initialization calldata to memory.\n    bytes memory implInitCode = implementationContractInitializationCode;\n    bytes memory data = metamorphicContractInitializationCalldata;\n\n    // move the initialization code from storage to memory.\n    bytes memory initCode = _metamorphicContractInitializationCode;\n\n    // declare variable to verify successful metamorphic contract deployment.\n    address deployedMetamorphicContract;\n\n    // determine the address of the metamorphic contract.\n    metamorphicContractAddress = _getMetamorphicContractAddress(salt);\n\n    // declare a variable for the address of the implementation contract.\n    address implementationContract;\n\n    // load implementation init code and length, then deploy via CREATE.\n    /* solhint-disable no-inline-assembly */\n    assembly {\n      let encoded_data := add(0x20, implInitCode) // load initialization code.\n      let encoded_size := mload(implInitCode)     // load init code's length.\n      implementationContract := create(       // call CREATE with 3 arguments.\n        0,                                    // do not forward any endowment.\n        encoded_data,                         // pass in initialization code.\n        encoded_size                          // pass in init code's length.\n      )\n    } /* solhint-enable no-inline-assembly */\n\n    require(\n      implementationContract != address(0),\n      \"Could not deploy implementation.\"\n    );\n\n    // store the implementation to be retrieved by the metamorphic contract.\n    _implementations[metamorphicContractAddress] = implementationContract;\n\n    // load metamorphic contract data and length of data and deploy via CREATE2.\n    /* solhint-disable no-inline-assembly */\n    assembly {\n      let encoded_data := add(0x20, initCode) // load initialization code.\n      let encoded_size := mload(initCode)     // load the init code's length.\n      deployedMetamorphicContract := create2( // call CREATE2 with 4 arguments.\n        0,                                    // do not forward any endowment.\n        encoded_data,                         // pass in initialization code.\n        encoded_size,                         // pass in init code's length.\n        salt                                  // pass in the salt value.\n      )\n    } /* solhint-enable no-inline-assembly */\n\n    // ensure that the contracts were successfully deployed.\n    require(\n      deployedMetamorphicContract == metamorphicContractAddress,\n      \"Failed to deploy the new metamorphic contract.\"\n    );\n\n    // initialize the new metamorphic contract if any data or value is provided.\n    if (data.length > 0 || msg.value > 0) {\n      /* solhint-disable avoid-call-value */\n      (bool success,) = deployedMetamorphicContract.call.value(msg.value)(data);\n      /* solhint-enable avoid-call-value */\n\n      require(success, \"Failed to initialize the new metamorphic contract.\");\n    }\n\n    emit Metamorphosed(deployedMetamorphicContract, implementationContract);\n  } /* solhint-enable function-max-lines */\n\n  /**\n   * @dev Deploy a metamorphic contract by submitting a given salt or nonce\n   * along with the address of an existing implementation contract to clone, and\n   * optionally provide calldata for initializing the new metamorphic contract.\n   * To replace the contract, first selfdestruct the current contract, then call\n   * with the same salt value and a new implementation address (be aware that\n   * all existing state will be wiped from the existing contract). Also note\n   * that the first 20 bytes of the salt must match the calling address, which\n   * prevents contracts from being created by unintended parties.\n   * @param salt bytes32 The nonce that will be passed into the CREATE2 call and\n   * thus will determine the resulant address of the metamorphic contract.\n   * @param implementationContract address The address of the existing\n   * implementation contract to clone.\n   * @param metamorphicContractInitializationCalldata bytes An optional data\n   * parameter that can be used to atomically initialize the metamorphic\n   * contract.\n   * @return Address of the metamorphic contract that will be created.\n   */\n  function deployMetamorphicContractFromExistingImplementation(\n    bytes32 salt,\n    address implementationContract,\n    bytes calldata metamorphicContractInitializationCalldata\n  ) external payable containsCaller(salt) returns (\n    address metamorphicContractAddress\n  ) {\n    // move initialization calldata to memory.\n    bytes memory data = metamorphicContractInitializationCalldata;\n\n    // move the initialization code from storage to memory.\n    bytes memory initCode = _metamorphicContractInitializationCode;\n\n    // declare variable to verify successful metamorphic contract deployment.\n    address deployedMetamorphicContract;\n\n    // determine the address of the metamorphic contract.\n    metamorphicContractAddress = _getMetamorphicContractAddress(salt);\n\n    // store the implementation to be retrieved by the metamorphic contract.\n    _implementations[metamorphicContractAddress] = implementationContract;\n\n    // using inline assembly: load data and length of data, then call CREATE2.\n    /* solhint-disable no-inline-assembly */\n    assembly {\n      let encoded_data := add(0x20, initCode) // load initialization code.\n      let encoded_size := mload(initCode)     // load the init code's length.\n      deployedMetamorphicContract := create2( // call CREATE2 with 4 arguments.\n        0,                                    // do not forward any endowment.\n        encoded_data,                         // pass in initialization code.\n        encoded_size,                         // pass in init code's length.\n        salt                                  // pass in the salt value.\n      )\n    } /* solhint-enable no-inline-assembly */\n\n    // ensure that the contracts were successfully deployed.\n    require(\n      deployedMetamorphicContract == metamorphicContractAddress,\n      \"Failed to deploy the new metamorphic contract.\"\n    );\n\n    // initialize the new metamorphic contract if any data or value is provided.\n    if (data.length > 0 || msg.value > 0) {\n      /* solhint-disable avoid-call-value */\n      (bool success,) = metamorphicContractAddress.call.value(msg.value)(data);\n      /* solhint-enable avoid-call-value */\n\n      require(success, \"Failed to initialize the new metamorphic contract.\");\n    }\n\n    emit Metamorphosed(deployedMetamorphicContract, implementationContract);\n  }\n\n  /* solhint-disable function-max-lines */\n  /**\n   * @dev Deploy a metamorphic contract by submitting a given salt or nonce\n   * along with the initialization code to a transient contract which will then\n   * deploy the metamorphic contract before immediately selfdestructing. To\n   * replace the metamorphic contract, first selfdestruct the current contract,\n   * then call with the same salt value and new initialization code (be aware\n   * that all existing state will be wiped from the existing contract). Also\n   * note that the first 20 bytes of the salt must match the calling address,\n   * which prevents contracts from being created by unintended parties.\n   * @param salt bytes32 The nonce that will be passed into the CREATE2 call and\n   * thus will determine the resulant address of the metamorphic contract.\n   * @param initializationCode bytes The initialization code for the metamorphic\n   * contract that will be deployed by the transient contract.\n   * @return Address of the metamorphic contract that will be created.\n   */\n  function deployMetamorphicContractWithConstructor(\n    bytes32 salt,\n    bytes calldata initializationCode\n  ) external payable containsCaller(salt) returns (\n    address metamorphicContractAddress\n  ) {\n    // move transient contract initialization code from storage to memory.\n    bytes memory initCode = _transientContractInitializationCode;\n\n    // declare variable to verify successful transient contract deployment.\n    address deployedTransientContract;\n\n    // determine the address of the transient contract.\n    address transientContractAddress = _getTransientContractAddress(salt);\n\n    // store the initialization code to be retrieved by the transient contract.\n    _initCodes[transientContractAddress] = initializationCode;\n\n    // load transient contract data and length of data, then deploy via CREATE2.\n    /* solhint-disable no-inline-assembly */\n    assembly {\n      let encoded_data := add(0x20, initCode) // load initialization code.\n      let encoded_size := mload(initCode)     // load the init code's length.\n      deployedTransientContract := create2(   // call CREATE2 with 4 arguments.\n        callvalue,                            // forward any supplied endowment.\n        encoded_data,                         // pass in initialization code.\n        encoded_size,                         // pass in init code's length.\n        salt                                  // pass in the salt value.\n      )\n    } /* solhint-enable no-inline-assembly */\n\n    // ensure that the contracts were successfully deployed.\n    require(\n      deployedTransientContract == transientContractAddress,\n      \"Failed to deploy metamorphic contract using given salt and init code.\"\n    );\n\n    metamorphicContractAddress = _getMetamorphicContractAddressWithConstructor(\n      transientContractAddress\n    );\n\n    emit MetamorphosedWithConstructor(\n      metamorphicContractAddress,\n      transientContractAddress\n    );\n  } /* solhint-enable function-max-lines */\n\n  /**\n   * @dev View function for retrieving the address of the implementation\n   * contract to clone. Called by the constructor of each metamorphic contract.\n   */\n  function getImplementation() external view returns (address implementation) {\n    return _implementations[msg.sender];\n  }\n\n  /**\n   * @dev View function for retrieving the initialization code for a given\n   * metamorphic contract to deploy via a transient contract. Called by the\n   * constructor of each transient contract.\n   * @return The initialization code to use to deploy the metamorphic contract.\n   */\n  function getInitializationCode() external view returns (\n    bytes memory initializationCode\n  ) {\n    return _initCodes[msg.sender];\n  }\n\n  /**\n   * @dev View function for retrieving the address of the current implementation\n   * contract of a given metamorphic contract, where the address of the contract\n   * is supplied as an argument. Be aware that the implementation contract has\n   * an independent state and may have been altered or selfdestructed from when\n   * it was last cloned by the metamorphic contract.\n   * @param metamorphicContractAddress address The address of the metamorphic\n   * contract.\n   * @return Address of the corresponding implementation contract.\n   */\n  function getImplementationContractAddress(\n    address metamorphicContractAddress\n  ) external view returns (address implementationContractAddress) {\n    return _implementations[metamorphicContractAddress];\n  }\n\n  /**\n   * @dev View function for retrieving the initialization code for a given\n   * metamorphic contract instance deployed via a transient contract, where the address\n   * of the transient contract is supplied as an argument.\n   * @param transientContractAddress address The address of the transient\n   * contract that deployed the metamorphic contract.\n   * @return The initialization code used to deploy the metamorphic contract.\n   */\n  function getMetamorphicContractInstanceInitializationCode(\n    address transientContractAddress\n  ) external view returns (bytes memory initializationCode) {\n    return _initCodes[transientContractAddress];\n  }\n\n  /**\n   * @dev Compute the address of the metamorphic contract that will be created\n   * upon submitting a given salt to the contract.\n   * @param salt bytes32 The nonce passed into CREATE2 by metamorphic contract.\n   * @return Address of the corresponding metamorphic contract.\n   */\n  function findMetamorphicContractAddress(\n    bytes32 salt\n  ) external view returns (address metamorphicContractAddress) {\n    // determine the address where the metamorphic contract will be deployed.\n    metamorphicContractAddress = _getMetamorphicContractAddress(salt);\n  }\n\n  /**\n   * @dev Compute the address of the transient contract that will be created\n   * upon submitting a given salt to the contract.\n   * @param salt bytes32 The nonce passed into CREATE2 when deploying the\n   * transient contract.\n   * @return Address of the corresponding transient contract.\n   */\n  function findTransientContractAddress(\n    bytes32 salt\n  ) external view returns (address transientContractAddress) {\n    // determine the address where the transient contract will be deployed.\n    transientContractAddress = _getTransientContractAddress(salt);\n  }\n\n  /**\n   * @dev Compute the address of the metamorphic contract that will be created\n   * by the transient contract upon submitting a given salt to the contract.\n   * @param salt bytes32 The nonce passed into CREATE2 when deploying the\n   * transient contract.\n   * @return Address of the corresponding metamorphic contract.\n   */\n  function findMetamorphicContractAddressWithConstructor(\n    bytes32 salt\n  ) external view returns (address metamorphicContractAddress) {\n    // determine the address of the metamorphic contract.\n    metamorphicContractAddress = _getMetamorphicContractAddressWithConstructor(\n      _getTransientContractAddress(salt)\n    );\n  }\n\n  /**\n   * @dev View function for retrieving the initialization code of metamorphic\n   * contracts for purposes of verification.\n   */\n  function getMetamorphicContractInitializationCode() external view returns (\n    bytes memory metamorphicContractInitializationCode\n  ) {\n    return _metamorphicContractInitializationCode;\n  }\n\n  /**\n   * @dev View function for retrieving the keccak256 hash of the initialization\n   * code of metamorphic contracts for purposes of verification.\n   */\n  function getMetamorphicContractInitializationCodeHash() external view returns (\n    bytes32 metamorphicContractInitializationCodeHash\n  ) {\n    return _metamorphicContractInitializationCodeHash;\n  }\n\n  /**\n   * @dev View function for retrieving the initialization code of transient\n   * contracts for purposes of verification.\n   */\n  function getTransientContractInitializationCode() external view returns (\n    bytes memory transientContractInitializationCode\n  ) {\n    return _transientContractInitializationCode;\n  }\n\n  /**\n   * @dev View function for retrieving the keccak256 hash of the initialization\n   * code of transient contracts for purposes of verification.\n   */\n  function getTransientContractInitializationCodeHash() external view returns (\n    bytes32 transientContractInitializationCodeHash\n  ) {\n    return _transientContractInitializationCodeHash;\n  }\n\n  /**\n   * @dev Internal view function for calculating a metamorphic contract address\n   * given a particular salt.\n   */\n  function _getMetamorphicContractAddress(\n    bytes32 salt\n  ) internal view returns (address) {\n    // determine the address of the metamorphic contract.\n    return address(\n      uint160(                      // downcast to match the address type.\n        uint256(                    // convert to uint to truncate upper digits.\n          keccak256(                // compute the CREATE2 hash using 4 inputs.\n            abi.encodePacked(       // pack all inputs to the hash together.\n              hex\"ff\",              // start with 0xff to distinguish from RLP.\n              address(this),        // this contract will be the caller.\n              salt,                 // pass in the supplied salt value.\n              _metamorphicContractInitializationCodeHash // the init code hash.\n            )\n          )\n        )\n      )\n    );\n  }\n\n  /**\n   * @dev Internal view function for calculating a transient contract address\n   * given a particular salt.\n   */\n  function _getTransientContractAddress(\n    bytes32 salt\n  ) internal view returns (address) {\n    // determine the address of the transient contract.\n    return address(\n      uint160(                      // downcast to match the address type.\n        uint256(                    // convert to uint to truncate upper digits.\n          keccak256(                // compute the CREATE2 hash using 4 inputs.\n            abi.encodePacked(       // pack all inputs to the hash together.\n              hex\"ff\",              // start with 0xff to distinguish from RLP.\n              address(this),        // this contract will be the caller.\n              salt,                 // pass in the supplied salt value.\n              _transientContractInitializationCodeHash // supply init code hash.\n            )\n          )\n        )\n      )\n    );\n  }\n\n  /**\n   * @dev Internal view function for calculating a metamorphic contract address\n   * that has been deployed via a transient contract given the address of the\n   * transient contract.\n   */\n  function _getMetamorphicContractAddressWithConstructor(\n    address transientContractAddress\n  ) internal pure returns (address) { \n    // determine the address of the metamorphic contract.\n    return address(\n      uint160(                          // downcast to match the address type.\n        uint256(                        // set to uint to truncate upper digits.\n          keccak256(                    // compute CREATE hash via RLP encoding.\n            abi.encodePacked(           // pack all inputs to the hash together.\n              byte(0xd6),               // first RLP byte.\n              byte(0x94),               // second RLP byte.\n              transientContractAddress, // called by the transient contract.\n              byte(0x01)                // nonce begins at 1 for contracts.\n            )\n          )\n        )\n      )\n    );\n  }\n\n  /**\n   * @dev Modifier to ensure that the first 20 bytes of a submitted salt match\n   * those of the calling account. This provides protection against the salt\n   * being stolen by frontrunners or other attackers.\n   * @param salt bytes32 The salt value to check against the calling address.\n   */\n  modifier containsCaller(bytes32 salt) {\n    // prevent contract submissions from being stolen from tx.pool by requiring\n    // that the first 20 bytes of the submitted salt match msg.sender.\n    require(\n      address(bytes20(salt)) == msg.sender,\n      \"Invalid salt - first 20 bytes of the salt must match calling address.\"\n    );\n    _;\n  }\n}",
  "abi": "[{\"constant\":true,\"inputs\":[],\"name\":\"getTransientContractInitializationCodeHash\",\"outputs\":[{\"name\":\"transientContractInitializationCodeHash\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getTransientContractInitializationCode\",\"outputs\":[{\"name\":\"transientContractInitializationCode\",\"type\":\"bytes\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"salt\",\"type\":\"bytes32\"},{\"name\":\"initializationCode\",\"type\":\"bytes\"}],\"name\":\"deployMetamorphicContractWithConstructor\",\"outputs\":[{\"name\":\"metamorphicContractAddress\",\"type\":\"address\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getInitializationCode\",\"outputs\":[{\"name\":\"initializationCode\",\"type\":\"bytes\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"transientContractAddress\",\"type\":\"address\"}],\"name\":\"getMetamorphicContractInstanceInitializationCode\",\"outputs\":[{\"name\":\"initializationCode\",\"type\":\"bytes\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getMetamorphicContractInitializationCodeHash\",\"outputs\":[{\"name\":\"metamorphicContractInitializationCodeHash\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"salt\",\"type\":\"bytes32\"}],\"name\":\"findMetamorphicContractAddressWithConstructor\",\"outputs\":[{\"name\":\"metamorphicContractAddress\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"salt\",\"type\":\"bytes32\"},{\"name\":\"implementationContractInitializationCode\",\"type\":\"bytes\"},{\"name\":\"metamorphicContractInitializationCalldata\",\"type\":\"bytes\"}],\"name\":\"deployMetamorphicContract\",\"outputs\":[{\"name\":\"metamorphicContractAddress\",\"type\":\"address\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"salt\",\"type\":\"bytes32\"},{\"name\":\"implementationContract\",\"type\":\"address\"},{\"name\":\"metamorphicContractInitializationCalldata\",\"type\":\"bytes\"}],\"name\":\"deployMetamorphicContractFromExistingImplementation\",\"outputs\":[{\"name\":\"metamorphicContractAddress\",\"type\":\"address\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"salt\",\"type\":\"bytes32\"}],\"name\":\"findTransientContractAddress\",\"outputs\":[{\"name\":\"transientContractAddress\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getImplementation\",\"outputs\":[{\"name\":\"implementation\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"salt\",\"type\":\"bytes32\"}],\"name\":\"findMetamorphicContractAddress\",\"outputs\":[{\"name\":\"metamorphicContractAddress\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"metamorphicContractAddress\",\"type\":\"address\"}],\"name\":\"getImplementationContractAddress\",\"outputs\":[{\"name\":\"implementationContractAddress\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"getMetamorphicContractInitializationCode\",\"outputs\":[{\"name\":\"metamorphicContractInitializationCode\",\"type\":\"bytes\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"transientContractInitializationCode\",\"type\":\"bytes\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"metamorphicContract\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"newImplementation\",\"type\":\"address\"}],\"name\":\"Metamorphosed\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"metamorphicContract\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"transientContract\",\"type\":\"address\"}],\"name\":\"MetamorphosedWithConstructor\",\"type\":\"event\"}]",
  "bytecode": "60806040523480156200001157600080fd5b50604051620015a1380380620015a1833981018060405260208110156200003757600080fd5b8101908080516401000000008111156200005057600080fd5b820160208101848111156200006457600080fd5b81516401000000008111828201871017156200007f57600080fd5b505060408051808201909152601d8082527f5860208158601c335a63aaf10f428752fa158151803b80938091923cf30000006020909201918252919450620000cd93506000925090620001f1565b5060006040516020018082805460018160011615610100020316600290048015620001325780601f106200010f57610100808354040283529182019162000132565b820191906000526020600020905b8154815290600101906020018083116200011d575b505060408051601f19818403018152919052805160209182012060015583516200016593506002925090840190620001f1565b5060026040516020018082805460018160011615610100020316600290048015620001ca5780601f10620001a7576101008083540402835291820191620001ca565b820191906000526020600020905b815481529060010190602001808311620001b5575b505060408051601f1981840301815291905280516020909101206003555062000296915050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200023457805160ff191683800117855562000264565b8280016001018555821562000264579182015b828111156200026457825182559160200191906001019062000247565b506200027292915062000276565b5090565b6200029391905b808211156200027257600081556001016200027d565b90565b6112fb80620002a66000396000f3fe6080604052600436106100dd5760003560e01c80636f8bda371161007f578063aaf10f4211610059578063aaf10f4214610425578063b5714de61461043a578063b7d2b0b414610464578063c762ef5814610497576100dd565b80636f8bda37146102ad57806382cd583314610376578063a32cfb69146103fb576100dd565b806357b9f523116100bb57806357b9f5231461022657806359449e551461023b578063641b2afa1461026e578063687c42fd14610283576100dd565b8063010fcf85146100e25780630563ef93146101095780632c51145c14610193575b600080fd5b3480156100ee57600080fd5b506100f76104ac565b60408051918252519081900360200190f35b34801561011557600080fd5b5061011e6104b3565b6040805160208082528351818301528351919283929083019185019080838360005b83811015610158578181015183820152602001610140565b50505050905090810190601f1680156101855780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b61020a600480360360408110156101a957600080fd5b813591908101906040810160208201356401000000008111156101cb57600080fd5b8201836020820111156101dd57600080fd5b803590602001918460018302840111640100000000831117156101ff57600080fd5b509092509050610546565b604080516001600160a01b039092168252519081900360200190f35b34801561023257600080fd5b5061011e610718565b34801561024757600080fd5b5061011e6004803603602081101561025e57600080fd5b50356001600160a01b0316610783565b34801561027a57600080fd5b506100f761082e565b34801561028f57600080fd5b5061020a600480360360208110156102a657600080fd5b5035610834565b61020a600480360360608110156102c357600080fd5b813591908101906040810160208201356401000000008111156102e557600080fd5b8201836020820111156102f757600080fd5b8035906020019184600183028401116401000000008311171561031957600080fd5b91939092909160208101903564010000000081111561033757600080fd5b82018360208201111561034957600080fd5b8035906020019184600183028401116401000000008311171561036b57600080fd5b50909250905061084d565b61020a6004803603606081101561038c57600080fd5b8135916001600160a01b03602082013516918101906060810160408201356401000000008111156103bc57600080fd5b8201836020820111156103ce57600080fd5b803590602001918460018302840111640100000000831117156103f057600080fd5b509092509050610c14565b34801561040757600080fd5b5061020a6004803603602081101561041e57600080fd5b5035610f30565b34801561043157600080fd5b5061020a610f3b565b34801561044657600080fd5b5061020a6004803603602081101561045d57600080fd5b5035610f57565b34801561047057600080fd5b5061020a6004803603602081101561048757600080fd5b50356001600160a01b0316610f62565b3480156104a357600080fd5b5061011e610f80565b6003545b90565b60028054604080516020601f600019610100600187161502019094168590049384018190048102820181019092528281526060939092909183018282801561053c5780601f106105115761010080835404028352916020019161053c565b820191906000526020600020905b81548152906001019060200180831161051f57829003601f168201915b5050505050905090565b600083606081901c6001600160a01b0316331461059757604051600160e51b62461bcd0281526004018080602001828103825260458152602001806112186045913960600191505060405180910390fd5b60028054604080516020601f60001961010060018716150201909416859004938401819004810282018101909252828152606093909290918301828280156106205780601f106105f557610100808354040283529160200191610620565b820191906000526020600020905b81548152906001019060200180831161060357829003601f168201915b5050505050905060008061063388610fe1565b6001600160a01b038116600090815260056020526040902090915061065990888861114d565b5082602001835189818334f593505050806001600160a01b0316826001600160a01b0316146106bc57604051600160e51b62461bcd02815260040180806020018281038252604581526020018061125d6045913960600191505060405180910390fd5b6106c581611043565b604080516001600160a01b0380841682528416602082015281519297507f5a450ff2319c286ed6a7b238e478f4c3c97d76f47704d5d9f4a568eb842afbd3929081900390910190a1505050509392505050565b3360009081526005602090815260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084526060939283018282801561053c5780601f106105115761010080835404028352916020019161053c565b6001600160a01b03811660009081526005602090815260409182902080548351601f60026000196101006001861615020190931692909204918201849004840281018401909452808452606093928301828280156108225780601f106107f757610100808354040283529160200191610822565b820191906000526020600020905b81548152906001019060200180831161080557829003601f168201915b50505050509050919050565b60015490565b600061084761084283610fe1565b611043565b92915050565b600085606081901c6001600160a01b0316331461089e57604051600160e51b62461bcd0281526004018080602001828103825260458152602001806112186045913960600191505060405180910390fd5b606086868080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525050604080516020601f8a0181900481028201810190925288815293945060609392508891508790819084018382808284376000920182905250805460408051602060026000196101006001871615020190941693909304601f8101849004840282018401909252818152969750606096955091935090915083018282801561099c5780601f106109715761010080835404028352916020019161099c565b820191906000526020600020905b81548152906001019060200180831161097f57829003601f168201915b5050505050905060006109ae8b6110eb565b9550600084602001855180826000f0925050506001600160a01b038116610a1f5760408051600160e51b62461bcd02815260206004820181905260248201527f436f756c64206e6f74206465706c6f7920696d706c656d656e746174696f6e2e604482015290519081900360640190fd5b6001600160a01b0387811660009081526004602090815260408220805473ffffffffffffffffffffffffffffffffffffffff191693851693909317909255845191850191908e9082908490f593505050866001600160a01b0316826001600160a01b031614610ac257604051600160e51b62461bcd02815260040180806020018281038252602e8152602001806112a2602e913960400191505060405180910390fd5b600084511180610ad25750600034115b15610bc0576000826001600160a01b031634866040518082805190602001908083835b60208310610b145780518252601f199092019160209182019101610af5565b6001836020036101000a03801982511681845116808217855250505050505090500191505060006040518083038185875af1925050503d8060008114610b76576040519150601f19603f3d011682016040523d82523d6000602084013e610b7b565b606091505b5050905080610bbe57604051600160e51b62461bcd0281526004018080602001828103825260328152602001806111e66032913960400191505060405180910390fd5b505b604080516001600160a01b0380851682528316602082015281517f2d2abf98ee3d10557b7f9aca6b41a1c0ee9095804e5dc6caa3c836995ceaeffb929181900390910190a150505050505095945050505050565b600084606081901c6001600160a01b03163314610c6557604051600160e51b62461bcd0281526004018080602001828103825260458152602001806112186045913960600191505060405180910390fd5b606084848080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920182905250805460408051602060026000196101006001871615020190941693909304601f81018490048402820184019092528181529697506060969550919350909150830182828015610d295780601f10610cfe57610100808354040283529160200191610d29565b820191906000526020600020905b815481529060010190602001808311610d0c57829003601f168201915b505050505090506000610d3b896110eb565b6001600160a01b0381811660009081526004602090815260408220805473ffffffffffffffffffffffffffffffffffffffff1916938d1693909317909255845192975090840191908b9082908490f592505050846001600160a01b0316816001600160a01b031614610de157604051600160e51b62461bcd02815260040180806020018281038252602e8152602001806112a2602e913960400191505060405180910390fd5b600083511180610df15750600034115b15610edf576000856001600160a01b031634856040518082805190602001908083835b60208310610e335780518252601f199092019160209182019101610e14565b6001836020036101000a03801982511681845116808217855250505050505090500191505060006040518083038185875af1925050503d8060008114610e95576040519150601f19603f3d011682016040523d82523d6000602084013e610e9a565b606091505b5050905080610edd57604051600160e51b62461bcd0281526004018080602001828103825260328152602001806111e66032913960400191505060405180910390fd5b505b604080516001600160a01b0380841682528a16602082015281517f2d2abf98ee3d10557b7f9aca6b41a1c0ee9095804e5dc6caa3c836995ceaeffb929181900390910190a150505050949350505050565b600061084782610fe1565b336000908152600460205260409020546001600160a01b031690565b6000610847826110eb565b6001600160a01b039081166000908152600460205260409020541690565b60008054604080516020601f600260001961010060018816150201909516949094049384018190048102820181019092528281526060939092909183018282801561053c5780601f106105115761010080835404028352916020019161053c565b600354604080517fff000000000000000000000000000000000000000000000000000000000000006020808301919091523060601b60218301526035820194909452605580820193909352815180820390930183526075019052805191012090565b604080517fd6000000000000000000000000000000000000000000000000000000000000006020808301919091527f940000000000000000000000000000000000000000000000000000000000000060218301526001600160a01b03841660601b60228301527f010000000000000000000000000000000000000000000000000000000000000060368301528251601781840301815260379092019092528051910120919050565b600154604080517fff000000000000000000000000000000000000000000000000000000000000006020808301919091523060601b60218301526035820194909452605580820193909352815180820390930183526075019052805191012090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061118e5782800160ff198235161785556111bb565b828001600101855582156111bb579182015b828111156111bb5782358255916020019190600101906111a0565b506111c79291506111cb565b5090565b6104b091905b808211156111c757600081556001016111d156fe4661696c656420746f20696e697469616c697a6520746865206e6577206d6574616d6f727068696320636f6e74726163742e496e76616c69642073616c74202d206669727374203230206279746573206f66207468652073616c74206d757374206d617463682063616c6c696e6720616464726573732e4661696c656420746f206465706c6f79206d6574616d6f727068696320636f6e7472616374207573696e6720676976656e2073616c7420616e6420696e697420636f64652e4661696c656420746f206465706c6f7920746865206e6577206d6574616d6f727068696320636f6e74726163742ea165627a7a7230582040a2612c311743060c0acf5302091f118547c549d97d08e7c02535e3a4e3fc42002900000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000108608060408190527f57b9f52300000000000000000000000000000000000000000000000000000000815260609033906357b9f5239060849060009060048186803b15801561004c57600080fd5b505afa158015610060573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052602081101561008957600080fd5b8101908080516401000000008111156100a157600080fd5b820160208101848111156100b457600080fd5b81516401000000008111828201871017156100ce57600080fd5b505092919050505090506000816020018251808234f0925050506001600160a01b0381166100fb57600080fd5b806001600160a01b0316fffe000000000000000000000000000000000000000000000000",
  "constructorArguments": "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000108608060408190527f57b9f52300000000000000000000000000000000000000000000000000000000815260609033906357b9f5239060849060009060048186803b15801561004c57600080fd5b505afa158015610060573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052602081101561008957600080fd5b8101908080516401000000008111156100a157600080fd5b820160208101848111156100b457600080fd5b81516401000000008111828201871017156100ce57600080fd5b505092919050505090506000816020018251808234f0925050506001600160a01b0381166100fb57600080fd5b806001600160a01b0316fffe000000000000000000000000000000000000000000000000"
}