{
  "address": "0x54e96d609b183196de657fc7380032a96f27f384",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "CryptoBossWannaCry",
  "compilerVersion": "v0.4.25+commit.59dbf8f1",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2018-09-22\n*/\n\npragma solidity ^0.4.25;\n\nlibrary SafeMath {\n\n    /**\n    * @dev Multiplies two numbers, throws on overflow.\n    */\n    function mul(uint256 a, uint256 b) internal pure returns (uint256) {\n        if (a == 0) {\n            return 0;\n        }\n        uint256 c = a * b;\n        assert(c / a == b);\n        return c;\n    }\n\n    /**\n    * @dev Integer division of two numbers, truncating the quotient.\n    */\n    function div(uint256 a, uint256 b) internal pure returns (uint256) {\n        // assert(b > 0); // Solidity automatically throws when dividing by 0\n        uint256 c = a / b;\n        // assert(a == b * c + a % b); // There is no case in which this doesn't hold\n        return c;\n    }\n\n    /**\n    * @dev Substracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).\n    */\n    function sub(uint256 a, uint256 b) internal pure returns (uint256) {\n        assert(b <= a);\n        return a - b;\n    }\n\n    /**\n    * @dev Adds two numbers, throws on overflow.\n    */\n    function add(uint256 a, uint256 b) internal pure returns (uint256) {\n        uint256 c = a + b;\n        assert(c >= a);\n        return c;\n    }\n\n    function min(uint256 a, uint256 b) internal pure returns (uint256) {\n        return a < b ? a : b;\n    }\n}\ncontract PullPayment {\n  using SafeMath for uint256;\n\n  mapping(address => uint256) public payments;\n  uint256 public totalPayments;\n\n  /**\n  * @dev Withdraw accumulated balance, called by payee.\n  */\n  function withdrawPayments() public {\n    address payee = msg.sender;\n    uint256 payment = payments[payee];\n\n    require(payment != 0);\n    require(address(this).balance >= payment);\n\n    totalPayments = totalPayments.sub(payment);\n    payments[payee] = 0;\n\n    payee.transfer(payment);\n  }\n\n  /**\n  * @dev Called by the payer to store the sent amount as credit to be pulled.\n  * @param dest The destination address of the funds.\n  * @param amount The amount to transfer.\n  */\n  function asyncSend(address dest, uint256 amount) internal {\n    payments[dest] = payments[dest].add(amount);\n    totalPayments = totalPayments.add(amount);\n  }\n}\ncontract CryptoEngineerInterface {\n    uint256 public prizePool = 0;\n\n    function calculateCurrentVirus(address /*_addr*/) public pure returns(uint256 /*_currentVirus*/) {}\n    function subVirus(address /*_addr*/, uint256 /*_value*/) public {}\n    function claimPrizePool(address /*_addr*/, uint256 /*_value*/) public {} \n    function fallback() public payable {}\n}\ninterface CryptoMiningWarInterface {\n    function addCrystal( address /*_addr*/, uint256 /*_value*/ ) external;\n    function subCrystal( address /*_addr*/, uint256 /*_value*/ ) external;\n}\ncontract CryptoBossWannaCry is PullPayment{\n    bool init = false;\n\taddress public administrator;\n    uint256 public bossRoundNumber;\n    uint256 private randNonce;\n    uint256 public BOSS_HP_DEFAULT = 10000000; \n    uint256 public HALF_TIME_ATK_BOSS = 0;\n    // engineer game infomation\n    uint256 constant public VIRUS_MINING_PERIOD = 86400; \n    uint256 public BOSS_DEF_DEFFAULT = 0;\n    CryptoEngineerInterface public EngineerContract;\n    CryptoMiningWarInterface public MiningwarContract;\n    \n    // player information\n    mapping(address => PlayerData) public players;\n    // boss information\n    mapping(uint256 => BossData) public bossData;\n        \n    struct PlayerData {\n        uint256 currentBossRoundNumber;\n        uint256 lastBossRoundNumber;\n        uint256 win;\n        uint256 share;\n        uint256 dame; \n        uint256 nextTimeAtk;\n    }\n\n    struct BossData {\n        uint256 bossRoundNumber;\n        uint256 bossHp;\n        uint256 def;\n        uint256 prizePool;\n        address playerLastAtk;\n        uint256 totalDame;\n        bool ended;\n    }\n    event eventAttackBoss(\n        uint256 bossRoundNumber,\n        address playerAtk,\n        uint256 virusAtk,\n        uint256 dame,\n        uint256 timeAtk,\n        bool isLastHit,\n        uint256 crystalsReward\n    );\n    event eventEndAtkBoss(\n        uint256 bossRoundNumber,\n        address playerWin,\n        uint256 ethBonus\n    );\n    modifier disableContract()\n    {\n        require(tx.origin == msg.sender);\n        _;\n    }\n    modifier isAdministrator()\n    {\n        require(msg.sender == administrator);\n        _;\n    }\n\n    constructor() public {\n        administrator = msg.sender;\n        // set interface main contract\n        EngineerContract = CryptoEngineerInterface(0x69fd0e5d0a93bf8bac02c154d343a8e3709adabf);\n        MiningwarContract = CryptoMiningWarInterface(0xf84c61bb982041c030b8580d1634f00fffb89059);\n    }\n    function () public payable\n    {\n        \n    }\n    function isContractMiniGame() public pure returns( bool _isContractMiniGame )\n    {\n    \t_isContractMiniGame = true;\n    }\n\n    /** \n    * @dev Main Contract call this function to setup mini game.\n    */\n    function setupMiniGame( uint256 /*_miningWarRoundNumber*/, uint256 /*_miningWarDeadline*/ ) public\n    {\n    \n    }\n     //@dev use this function in case of bug\n    function upgrade(address addr) public \n    {\n        require(msg.sender == administrator);\n        selfdestruct(addr);\n    }\n\n    function startGame() public isAdministrator\n    {\n        require(init == false);\n        init = true;\n        bossData[bossRoundNumber].ended = true;\n    \n        startNewBoss();\n    }\n    /**\n    * @dev set defence for boss\n    * @param _value number defence\n    */\n    function setDefenceBoss(uint256 _value) public isAdministrator\n    {\n        BOSS_DEF_DEFFAULT = _value;  \n    }\n    /**\n    * @dev set HP for boss\n    * @param _value number HP default\n    */\n    function setBossHPDefault(uint256 _value) public isAdministrator\n    {\n        BOSS_HP_DEFAULT = _value;  \n    }\n    function setHalfTimeAtkBoss(uint256 _value) public isAdministrator\n    {\n        HALF_TIME_ATK_BOSS = _value;  \n    }\n    function startNewBoss() private\n    {\n        require(bossData[bossRoundNumber].ended == true);\n\n        bossRoundNumber = bossRoundNumber + 1;\n\n        uint256 bossHp = BOSS_HP_DEFAULT * bossRoundNumber;\n        // claim 5% of current prizePool as rewards.\n        uint256 engineerPrizePool = getEngineerPrizePool();\n        uint256 prizePool = SafeMath.div(SafeMath.mul(engineerPrizePool, 5),100);\n        EngineerContract.claimPrizePool(address(this), prizePool); \n\n        bossData[bossRoundNumber] = BossData(bossRoundNumber, bossHp, BOSS_DEF_DEFFAULT, prizePool, 0x0, 0, false);\n    }\n    function endAtkBoss() private \n    {\n        require(bossData[bossRoundNumber].ended == false);\n        require(bossData[bossRoundNumber].totalDame >= bossData[bossRoundNumber].bossHp);\n\n        BossData storage b = bossData[bossRoundNumber];\n        b.ended = true;\n         // update eth bonus for player last hit\n        uint256 ethBonus = SafeMath.div( SafeMath.mul(b.prizePool, 5), 100 );\n\n        if (b.playerLastAtk != 0x0) {\n            PlayerData storage p = players[b.playerLastAtk];\n            p.win =  p.win + ethBonus;\n        }\n\n        emit eventEndAtkBoss(bossRoundNumber, b.playerLastAtk, ethBonus);\n        startNewBoss();\n    }\n    /**\n    * @dev player atk the boss\n    * @param _value number virus for this attack boss\n    */\n    function atkBoss(uint256 _value) public disableContract\n    {\n        require(bossData[bossRoundNumber].ended == false);\n        require(bossData[bossRoundNumber].totalDame < bossData[bossRoundNumber].bossHp);\n        require(players[msg.sender].nextTimeAtk <= now);\n\n        uint256 currentVirus = getEngineerCurrentVirus(msg.sender);        \n        if (_value > currentVirus) { revert(); }\n        EngineerContract.subVirus(msg.sender, _value);\n        \n        uint256 rate = 50 + randomNumber(msg.sender, 60); // 50 - 110%\n        \n        uint256 atk = SafeMath.div(SafeMath.mul(_value, rate), 100);\n        \n        updateShareETH(msg.sender);\n\n        // update dame\n        BossData storage b = bossData[bossRoundNumber];\n        \n        uint256 currentTotalDame = b.totalDame;\n        uint256 dame = 0;\n        if (atk > b.def) {\n            dame = SafeMath.sub(atk, b.def);\n        }\n\n        b.totalDame = SafeMath.min(SafeMath.add(currentTotalDame, dame), b.bossHp);\n        b.playerLastAtk = msg.sender;\n\n        dame = SafeMath.sub(b.totalDame, currentTotalDame);\n\n        // bonus crystals\n        uint256 crystalsBonus = SafeMath.div(SafeMath.mul(dame, 5), 100);\n        MiningwarContract.addCrystal(msg.sender, crystalsBonus);\n        // update player\n        PlayerData storage p = players[msg.sender];\n\n        p.nextTimeAtk = now + HALF_TIME_ATK_BOSS;\n\n        if (p.currentBossRoundNumber == bossRoundNumber) {\n            p.dame = SafeMath.add(p.dame, dame);\n        } else {\n            p.currentBossRoundNumber = bossRoundNumber;\n            p.dame = dame;\n        }\n\n        bool isLastHit;\n        if (b.totalDame >= b.bossHp) {\n            isLastHit = true;\n            endAtkBoss();\n        }\n        \n        // emit event attack boss\n        emit eventAttackBoss(b.bossRoundNumber, msg.sender, _value, dame, now, isLastHit, crystalsBonus);\n    }\n \n    function updateShareETH(address _addr) private\n    {\n        PlayerData storage p = players[_addr];\n        \n        if ( \n            bossData[p.currentBossRoundNumber].ended == true &&\n            p.lastBossRoundNumber < p.currentBossRoundNumber\n            ) {\n            p.share = SafeMath.add(p.share, calculateShareETH(msg.sender, p.currentBossRoundNumber));\n            p.lastBossRoundNumber = p.currentBossRoundNumber;\n        }\n    }\n\n    /**\n    * @dev calculate share Eth of player\n    */\n    function calculateShareETH(address _addr, uint256 _bossRoundNumber) public view returns(uint256 _share)\n    {\n        PlayerData memory p = players[_addr];\n        BossData memory b = bossData[_bossRoundNumber];\n        if ( \n            p.lastBossRoundNumber >= p.currentBossRoundNumber && \n            p.currentBossRoundNumber != 0 \n            ) {\n            _share = 0;\n        } else {\n            _share = SafeMath.div(SafeMath.mul(SafeMath.mul(b.prizePool, 95), p.dame), SafeMath.mul(b.totalDame, 100)); // prizePool * 95% * playerDame / totalDame \n        } \n        if (b.ended == false) {\n            _share = 0;\n        }\n    }\n\n    function withdrawReward() public disableContract\n    {\n        updateShareETH(msg.sender);\n        PlayerData storage p = players[msg.sender];\n        \n        uint256 reward = SafeMath.add(p.share, p.win);\n        msg.sender.send(reward);\n        // update player\n        p.win = 0;\n        p.share = 0;\n    }\n    //--------------------------------------------------------------------------\n    // INTERNAL FUNCTION\n    //--------------------------------------------------------------------------\n    function devFee(uint256 _amount) private pure returns(uint256)\n    {\n        return SafeMath.div(SafeMath.mul(_amount, 5), 100);\n    }\n    function randomNumber(address _addr, uint256 _maxNumber) private returns(uint256)\n    {\n        randNonce = randNonce + 1;\n        return uint256(keccak256(abi.encodePacked(now, _addr, randNonce))) % _maxNumber;\n    }\n    function getEngineerPrizePool() private view returns(uint256 _prizePool)\n    {\n        _prizePool = EngineerContract.prizePool();\n    }\n    function getEngineerCurrentVirus(address _addr) private view returns(uint256 _currentVirus)\n    {\n        _currentVirus = EngineerContract.calculateCurrentVirus(_addr);\n        _currentVirus = SafeMath.div(_currentVirus, VIRUS_MINING_PERIOD);\n    }\n}",
  "bytecode": "60806040526002805460ff19169055629896806005556000600681905560075534801561002b57600080fd5b5060028054610100330261010060a860020a031990911617905560088054600160a060020a03199081167369fd0e5d0a93bf8bac02c154d343a8e3709adabf179091556009805490911673f84c61bb982041c030b8580d1634f00fffb890591790556112098061009c6000396000f3006080604052600436106101315763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416625b448781146101335780630900f0101461015a5780630b3fe32d1461017b578063150228f414610193578063306142c3146101a85780633281d576146102035780633b5a2a3b1461022c5780633b8678de1461024157806351ab01b51461025957806358838f891461026e5780636103d70b1461029f578063614781f9146102b457806379eb16d4146102cc578063b106cc2c146102f0578063be7ccd7e14610305578063c533799214610320578063c885bc5814610338578063ccdc30971461034d578063d65ab5f214610362578063e12936d014610377578063e2982c211461038c578063e2eb41ff146103ad578063f53d0a8e14610401575b005b34801561013f57600080fd5b50610148610416565b60408051918252519081900360200190f35b34801561016657600080fd5b50610131600160a060020a036004351661041c565b34801561018757600080fd5b50610131600435610444565b34801561019f57600080fd5b50610148610465565b3480156101b457600080fd5b506101c060043561046b565b604080519788526020880196909652868601949094526060860192909252600160a060020a0316608085015260a0840152151560c0830152519081900360e00190f35b34801561020f57600080fd5b506102186104b5565b604080519115158252519081900360200190f35b34801561023857600080fd5b506101486104ba565b34801561024d57600080fd5b506101316004356104c0565b34801561026557600080fd5b506101486104e1565b34801561027a57600080fd5b506102836104e7565b60408051600160a060020a039092168252519081900360200190f35b3480156102ab57600080fd5b506101316104f6565b3480156102c057600080fd5b5061013160043561057f565b3480156102d857600080fd5b50610148600160a060020a03600435166024356108b2565b3480156102fc57600080fd5b50610283610a44565b34801561031157600080fd5b50610131600435602435610a53565b34801561032c57600080fd5b50610131600435610a57565b34801561034457600080fd5b50610131610a78565b34801561035957600080fd5b50610148610ae9565b34801561036e57600080fd5b50610131610aef565b34801561038357600080fd5b50610148610b54565b34801561039857600080fd5b50610148600160a060020a0360043516610b5b565b3480156103b957600080fd5b506103ce600160a060020a0360043516610b6d565b604080519687526020870195909552858501939093526060850191909152608084015260a0830152519081900360c00190f35b34801561040d57600080fd5b50610283610ba2565b60015481565b6002546101009004600160a060020a0316331461043857600080fd5b80600160a060020a0316ff5b6002546101009004600160a060020a0316331461046057600080fd5b600655565b60075481565b600b6020526000908152604090208054600182015460028301546003840154600485015460058601546006909601549495939492939192600160a060020a03909116919060ff1687565b600190565b60065481565b6002546101009004600160a060020a031633146104dc57600080fd5b600755565b60055481565b600854600160a060020a031681565b3360008181526020819052604090205480151561051257600080fd5b303181111561052057600080fd5b600154610533908263ffffffff610bb616565b600155600160a060020a0382166000818152602081905260408082208290555183156108fc0291849190818181858888f1935050505015801561057a573d6000803e3d6000fd5b505050565b6000808080808080808032331461059557600080fd5b6003546000908152600b602052604090206006015460ff16156105b757600080fd5b6003546000908152600b602052604090206001810154600590910154106105dd57600080fd5b336000908152600a60205260409020600501544210156105fc57600080fd5b61060533610bc8565b9850888a111561061457600080fd5b600854604080517f920775d4000000000000000000000000000000000000000000000000000000008152336004820152602481018d90529051600160a060020a039092169163920775d49160448082019260009290919082900301818387803b15801561068057600080fd5b505af1158015610694573d6000803e3d6000fd5b505050506106a333603c610c74565b60320197506106bc6106b58b8a610d43565b6064610d79565b96506106c733610d90565b6003546000908152600b60205260408120600581015460028201549198509650909450871115610702576106ff878760020154610bb6565b93505b61071961070f8686610e03565b8760010154610e12565b6005870181905560048701805473ffffffffffffffffffffffffffffffffffffffff19163317905561074b9086610bb6565b935061075b6106b5856005610d43565b600954604080517ff6e212ea000000000000000000000000000000000000000000000000000000008152336004820152602481018490529051929550600160a060020a039091169163f6e212ea9160448082019260009290919082900301818387803b1580156107ca57600080fd5b505af11580156107de573d6000803e3d6000fd5b5050336000908152600a6020526040902060065442016005820155600354815491955014159150610823905057610819826004015485610e03565b6004830155610830565b6003548255600482018490555b600186015460058701541061084a5750600161084a610e2a565b8554604080519182523360208301528181018c90526060820186905242608083015282151560a083015260c08201859052517f2f28cfb5607aee6bd4be995389c905f989cd7a885ffd2a33bb150db7dbd1c9da9181900360e00190a150505050505050505050565b60006108bc61115d565b6108c4611194565b600a600086600160a060020a0316600160a060020a0316815260200190815260200160002060c0604051908101604052908160008201548152602001600182015481526020016002820154815260200160038201548152602001600482015481526020016005820154815250509150600b600085815260200190815260200160002060e06040519081016040529081600082015481526020016001820154815260200160028201548152602001600382015481526020016004820160009054906101000a9004600160a060020a0316600160a060020a0316600160a060020a03168152602001600582015481526020016006820160009054906101000a900460ff161515151581525050905081600001518260200151101580156109e85750815115155b156109f65760009250610a2c565b610a29610a15610a0b8360600151605f610d43565b8460800151610d43565b610a248360a001516064610d43565b610d79565b92505b60c08101511515610a3c57600092505b505092915050565b600954600160a060020a031681565b5050565b6002546101009004600160a060020a03163314610a7357600080fd5b600555565b600080323314610a8757600080fd5b610a9033610d90565b336000908152600a6020526040902060038101546002820154919350610ab591610e03565b604051909150339082156108fc029083906000818181858888f1505060006002860181905560039095019490945550505050565b60035481565b6002546101009004600160a060020a03163314610b0b57600080fd5b60025460ff1615610b1b57600080fd5b60028054600160ff1991821681179092556003546000908152600b6020526040902060060180549091169091179055610b52610f40565b565b6201518081565b60006020819052908152604090205481565b600a60205260009081526040902080546001820154600283015460038401546004850154600590950154939492939192909186565b6002546101009004600160a060020a031681565b600082821115610bc257fe5b50900390565b600854604080517f207a6c33000000000000000000000000000000000000000000000000000000008152600160a060020a0384811660048301529151600093929092169163207a6c339160248082019260209290919082900301818787803b158015610c3357600080fd5b505af1158015610c47573d6000803e3d6000fd5b505050506040513d6020811015610c5d57600080fd5b50519050610c6e8162015180610d79565b92915050565b60006004546001016004819055508142846004546040516020018084815260200183600160a060020a0316600160a060020a03166c0100000000000000000000000002815260140182815260200193505050506040516020818303038152906040526040518082805190602001908083835b60208310610d055780518252601f199092019160209182019101610ce6565b5181516020939093036101000a6000190180199091169216919091179052604051920182900390912092505050811515610d3b57fe5b069392505050565b600080831515610d565760009150610d72565b50828202828482811515610d6657fe5b0414610d6e57fe5b8091505b5092915050565b6000808284811515610d8757fe5b04949350505050565b600160a060020a0381166000908152600a6020908152604080832080548452600b9092529091206006015460ff1615156001148015610dd3575080546001820154105b15610a5357610df38160030154610dee3384600001546108b2565b610e03565b6003820155805460018201555050565b600082820183811015610d6e57fe5b6000818310610e215781610e23565b825b9392505050565b6003546000908152600b60205260408120600601548190819060ff1615610e5057600080fd5b6003546000908152600b6020526040902060018101546005909101541015610e7757600080fd5b600380546000908152600b6020526040902060068101805460ff1916600117905590810154909350610eae906106b5906005610d43565b6004840154909250600160a060020a031615610eec57506004820154600160a060020a03166000908152600a60205260409020600281018054830190555b600354600484015460408051928352600160a060020a039091166020830152818101849052517f5229ba1885e10d7150c8a110ec429fe8001c5ba7af2ff0c2c5cd244fc05b89829181900360600190a161057a5b6003546000908152600b60205260408120600601548190819060ff161515600114610f6a57600080fd5b6003805460010190819055600554029250610f836110cd565b9150610f936106b5836005610d43565b600854604080517f7baf71f9000000000000000000000000000000000000000000000000000000008152306004820152602481018490529051929350600160a060020a0390911691637baf71f99160448082019260009290919082900301818387803b15801561100257600080fd5b505af1158015611016573d6000803e3d6000fd5b50506040805160e081018252600380548083526020808401998a526007548486019081526060850198895260006080860181815260a0870182815260c08801838152958352600b909452969020945185559951600185015598516002840155955190820155905160048201805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a03909216919091179055945160058601555050516006909201805460ff19169215159290921790915550565b600854604080517f719ce73e0000000000000000000000000000000000000000000000000000000081529051600092600160a060020a03169163719ce73e91600480830192602092919082900301818787803b15801561112c57600080fd5b505af1158015611140573d6000803e3d6000fd5b505050506040513d602081101561115657600080fd5b5051919050565b60c0604051908101604052806000815260200160008152602001600081526020016000815260200160008152602001600081525090565b60e060405190810160405280600081526020016000815260200160008152602001600081526020016000600160a060020a031681526020016000815260200160001515815250905600a165627a7a723058207af8191826a81bb3726aead04854de865c8648f0bed0bc6f2bc420bf9f8db2870029"
}