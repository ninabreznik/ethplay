{
  "address": "0xe448c94856b36ffb701fb5a578452d32f52788ea",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "P3Daily",
  "compilerVersion": "v0.4.25+commit.59dbf8f1",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2018-10-11\n*/\n\npragma solidity ^0.4.25;\n\ncontract P3Daily {\n    \n    using SafeMath for uint256;\n    \n    struct Round {\n        uint256 pot;\n        uint256 ticketsSold;\n        uint256 blockNumber;\n        uint256 startTime;\n        mapping(uint256 => address) tickets;\n        mapping(address => uint256) ticketsPerAddress;\n    }\n    \n    HourglassInterface constant p3dContract = HourglassInterface(0xB3775fB83F7D12A36E0475aBdD1FCA35c091efBe);\n    address constant sacMasternode = address(0x4fac33dAbFd83d160717dFee4175d9cAaA249CA5);\n    address constant dev = address(0xF0EA6CE7d210Ee58e83a463Af13989B5c2DbE108);\n    \n    uint256 constant public PRICE_PER_TICKET = 0.01 ether;\n    uint256 constant public ROUND_LENGTH = 24 hours;\n    \n    mapping(uint256 => Round) public rounds;\n    mapping(address => uint256) private vault;\n    \n    uint256 public currentRoundNumber;\n    \n    event TicketsPurchased(address indexed player, uint256 indexed amount);\n    event LotteryWinner(address indexed winner, uint256 indexed winnings, uint256 indexed ticket);\n    event WithdrawVault(address indexed player, uint256 indexed amaount);\n    event Validator(address indexed validator, uint256 indexed reward);\n    \n    modifier isValidPurchase(uint256 _howMany)\n    {\n        require(_howMany > 0);\n        require(msg.value == _howMany.mul(PRICE_PER_TICKET));\n        _;\n    }\n    \n    modifier canPayFromVault(uint256 _howMany)\n    {\n        require(_howMany > 0);\n        require(vault[msg.sender] >= _howMany.mul(PRICE_PER_TICKET));\n        _;\n    }\n    \n    modifier positiveVaultBalance()\n    {\n        require(vault[msg.sender] > 0);\n        _;\n    }\n    \n    constructor()\n        public\n    {\n        currentRoundNumber = 0;\n        rounds[currentRoundNumber] = Round(0, 0, 0, now);\n    }\n    \n    function() external payable {}\n       \n    function isRoundOver()\n        public\n        view\n        returns(bool)\n    {\n        return now >= rounds[currentRoundNumber].startTime.add(ROUND_LENGTH);\n    }\n    \n    function potentialWinner()\n        external\n        view\n        returns(address)\n    {\n        if(isRoundOver() &&\n        rounds[currentRoundNumber].blockNumber != 0 &&\n        block.number - 256 <= rounds[currentRoundNumber].blockNumber &&\n        rounds[currentRoundNumber].blockNumber != block.number) {\n            uint256 potentialwinningTicket = uint256(blockhash(rounds[currentRoundNumber].blockNumber)) % rounds[currentRoundNumber].ticketsSold;\n            return rounds[currentRoundNumber].tickets[potentialwinningTicket];\n        }\n        \n        return address(0);\n    }\n    \n    function blocksUntilNewPotentialWinner()\n        external\n        view\n        returns (uint256)\n    {\n        if(isRoundOver() &&\n        rounds[currentRoundNumber].blockNumber != 0 &&\n        block.number - 256 <= rounds[currentRoundNumber].blockNumber &&\n        rounds[currentRoundNumber].blockNumber != block.number) {\n           return 256 - (block.number - rounds[currentRoundNumber].blockNumber);\n        }\n        \n        return 0;\n    }\n    \n    function getTicketOwner(uint256 _number)\n        external\n        view\n        returns(address)\n    {\n        return rounds[currentRoundNumber].tickets[_number];\n    }\n    \n     function ticketsPurchased()\n        external\n        view\n        returns(uint256)\n    {\n        return rounds[currentRoundNumber].ticketsSold;\n    }\n    \n    function timeLeft()\n        external\n        view\n        returns(uint256)\n    {\n        if(isRoundOver()) {\n            return 0;\n        }\n        \n        return ROUND_LENGTH.sub(now.sub(rounds[currentRoundNumber].startTime));\n    }\n    \n    function jackpotSize()\n        external\n        view\n        returns(uint256)\n    {\n        return rounds[currentRoundNumber].pot.add(p3dContract.myDividends(true)).mul(97) / 100;\n    }\n    \n    function validatorReward()\n        external\n        view\n        returns(uint256)\n    {\n        return rounds[currentRoundNumber].pot.add(p3dContract.myDividends(true)) / 100;\n    }\n    \n    function myVault()\n        external\n        view\n        returns(uint256)\n    {\n        return vault[msg.sender];\n    }\n    \n    function myTickets()\n        external\n        view\n        returns(uint256)\n    {\n        return rounds[currentRoundNumber].ticketsPerAddress[msg.sender];\n    }\n    \n    function purchaseTicket(uint256 _howMany)\n        external\n        payable\n        isValidPurchase(_howMany)\n    {\n        if(!isRoundOver() || onRoundEnd()) {\n            acceptPurchase(_howMany, msg.value);\n        } else {\n            vault[msg.sender] = vault[msg.sender].add(msg.value);\n        }\n    }\n    \n    function purchaseFromVault(uint256 _howMany)\n        external\n        canPayFromVault(_howMany)\n    {\n        if(!isRoundOver() || onRoundEnd()) {\n            uint256 value = _howMany.mul(PRICE_PER_TICKET);\n            vault[msg.sender] -= value;\n            acceptPurchase(_howMany, value);\n        }\n    }\n    \n    function validate()\n        external\n    {\n        require(isRoundOver());\n        \n        onRoundEnd();\n    }\n    \n    function withdrawFromVault()\n        external\n        positiveVaultBalance\n    {\n        uint256 amount = vault[msg.sender];\n        vault[msg.sender] = 0;\n        \n        emit WithdrawVault(msg.sender, amount);\n        \n        msg.sender.transfer(amount);\n    }\n    \n    function onRoundEnd()\n        private\n        returns(bool newRound)\n    {\n        //no tickets sold => create new round\n        if(rounds[currentRoundNumber].ticketsSold == 0) {\n            currentRoundNumber++;\n            rounds[currentRoundNumber] = Round(0, 0, 0, now);\n            return true;\n        }\n        \n        //blocknumber has not been chosen or is too old => set new one\n        if(rounds[currentRoundNumber].blockNumber == 0 || block.number - 256 > rounds[currentRoundNumber].blockNumber) {\n            rounds[currentRoundNumber].blockNumber = block.number;\n            return false;\n        }\n        \n        //can't determine hash of current block\n        if(block.number == rounds[currentRoundNumber].blockNumber) {return false;}\n        \n        //determine winner\n        uint256 winningTicket = uint256(blockhash(rounds[currentRoundNumber].blockNumber)) % rounds[currentRoundNumber].ticketsSold;\n        address winner = rounds[currentRoundNumber].tickets[winningTicket];\n        \n        uint256 totalWinnings = rounds[currentRoundNumber].pot;\n        \n        uint256 dividends = p3dContract.myDividends(true);\n        if(dividends > 0) {\n            p3dContract.withdraw();\n            totalWinnings = totalWinnings.add(dividends);\n        }\n        \n        //winner reward\n        uint256 winnings = totalWinnings.mul(97) / 100;\n        vault[winner] = vault[winner].add(winnings);\n        emit LotteryWinner(winner, winnings, winningTicket);\n        \n        //validator reward\n        vault[msg.sender] = vault[msg.sender].add(totalWinnings / 100);\n        emit Validator(msg.sender, totalWinnings / 100);\n        \n        //dev fee\n        vault[dev] = vault[dev].add(totalWinnings.mul(2) / 100);\n        \n        currentRoundNumber++;\n        rounds[currentRoundNumber] = Round(0, 0, 0, now);\n        return true;\n    }\n    \n    function acceptPurchase(uint256 _howMany, uint256 value)\n        private\n    {\n        uint256 ticketsSold = rounds[currentRoundNumber].ticketsSold;\n        uint256 boundary = _howMany.add(ticketsSold);\n        \n        for(uint256 i = ticketsSold; i < boundary; i++) {\n            rounds[currentRoundNumber].tickets[i] = msg.sender;\n        }\n        \n        rounds[currentRoundNumber].ticketsSold = boundary;\n        rounds[currentRoundNumber].pot = rounds[currentRoundNumber].pot.add(value.mul(60) / 100);\n        rounds[currentRoundNumber].ticketsPerAddress[msg.sender] = rounds[currentRoundNumber].ticketsPerAddress[msg.sender].add(_howMany);\n        \n        emit TicketsPurchased(msg.sender, _howMany);\n        \n        p3dContract.buy.value(value.mul(40) / 100)(sacMasternode);\n    }\n}\n\ninterface HourglassInterface {\n    function buy(address _playerAddress) payable external returns(uint256);\n    function withdraw() external;\n    function myDividends(bool _includeReferralBonus) external view returns(uint256);\n}\n\nlibrary SafeMath {\n\n  function mul(uint256 a, uint256 b) internal pure returns (uint256) {\n    if (a == 0) {\n      return 0;\n    }\n\n    uint256 c = a * b;\n    require(c / a == b);\n\n    return c;\n  }\n\n  function sub(uint256 a, uint256 b) internal pure returns (uint256) {\n    require(b <= a);\n    uint256 c = a - b;\n\n    return c;\n  }\n\n  function add(uint256 a, uint256 b) internal pure returns (uint256) {\n    uint256 c = a + b;\n    require(c >= a);\n\n    return c;\n  }\n}",
  "bytecode": "608060405234801561001057600080fd5b506000600281905560408051608081018252828152602080820184815292820184815242606084019081528580529490915290517fad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb55590517fad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb655517fad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb755517fad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb855610fa2806100df6000396000f3006080604052600436106100e15763ffffffff60e060020a600035041662ea873781146100e3578063091dffca1461010a5780631300a6d11461011f578063305876a7146101345780635049b2381461015d57806357246d231461018e5780636901f668146101a35780636de652b7146101b857806375b94133146101cd5780638c65c81f146101e257806390a7ba5b146102205780639c4780d8146102355780639e817c031461024a5780639f5f05201461025f578063ad09340914610274578063b948348c1461028c578063f86c8ed314610297578063fe2545dc146102ac575b005b3480156100ef57600080fd5b506100f86102c4565b60408051918252519081900360200190f35b34801561011657600080fd5b506100e16102e6565b34801561012b57600080fd5b506100f8610375565b34801561014057600080fd5b506101496103cb565b604080519115158252519081900360200190f35b34801561016957600080fd5b506101726103fb565b60408051600160a060020a039092168252519081900360200190f35b34801561019a57600080fd5b506100f86104cc565b3480156101af57600080fd5b506100e161059f565b3480156101c457600080fd5b506100f86105bd565b3480156101d957600080fd5b506100f86105c8565b3480156101ee57600080fd5b506101fa60043561063f565b604080519485526020850193909352838301919091526060830152519081900360800190f35b34801561022c57600080fd5b506100f8610666565b34801561024157600080fd5b506100f861067e565b34801561025657600080fd5b506100f8610684565b34801561026b57600080fd5b506100f861068b565b34801561028057600080fd5b5061017260043561069e565b6100e16004356106c8565b3480156102a357600080fd5b506100f8610757565b3480156102b857600080fd5b506100e16004356107ec565b6002546000908152602081815260408083203384526005019091529020545b90565b33600090815260016020526040812054811061030157600080fd5b503360008181526001602052604080822080549083905590519092839290917f781b06ede92edf4c49c9ae27f17beea169c6638a088cc245c6ebfe1011a770cf9190a3604051339082156108fc029083906000818181858888f19350505050158015610371573d6000803e3d6000fd5b5050565b600061037f6103cb565b1561038c575060006102e3565b6002546000908152602081905260409020600301546103c6906103b690429063ffffffff61088716565b620151809063ffffffff61088716565b905090565b6002546000908152602081905260408120600301546103f3906201518063ffffffff6108a516565b421015905090565b6000806104066103cb565b80156104245750600280546000908152602081905260409020015415155b80156104475750600280546000908152602081905260409020015460ff19430111155b8015610466575060028054600090815260208190526040902001544314155b156104c35760028054600090815260208190526040902060018101549101544081151561048f57fe5b60025460009081526020818152604080832094909306808352600490940190522054600160a060020a0316925090506104c8565b600091505b5090565b60006064610590606161058473b3775fb83f7d12a36e0475abdd1fca35c091efbe600160a060020a031663688abbf760016040518263ffffffff1660e060020a0281526004018082151515158152602001915050602060405180830381600087803b15801561053a57600080fd5b505af115801561054e573d6000803e3d6000fd5b505050506040513d602081101561056457600080fd5b50516002546000908152602081905260409020549063ffffffff6108a516565b9063ffffffff6108be16565b81151561059957fe5b04905090565b6105a76103cb565b15156105b257600080fd5b6105ba6108ec565b50565b662386f26fc1000081565b604080517f688abbf70000000000000000000000000000000000000000000000000000000081526001600482015290516000916064916105909173b3775fb83f7d12a36e0475abdd1fca35c091efbe9163688abbf79160248082019260209290919082900301818987803b15801561053a57600080fd5b60006020819052908152604090208054600182015460028301546003909301549192909184565b60025460009081526020819052604090206001015490565b60025481565b6201518081565b3360009081526001602052604090205490565b600254600090815260208181526040808320938352600490930190522054600160a060020a031690565b80600081116106d657600080fd5b6106ed81662386f26fc1000063ffffffff6108be16565b34146106f857600080fd5b6107006103cb565b158061070f575061070f6108ec565b156107235761071e8234610d59565b610371565b33600090815260016020526040902054610743903463ffffffff6108a516565b336000908152600160205260409020555050565b60006107616103cb565b801561077f5750600280546000908152602081905260409020015415155b80156107a25750600280546000908152602081905260409020015460ff19430111155b80156107c1575060028054600090815260208190526040902001544314155b156107e6575060028054600090815260208190526040902001544303610100036102e3565b50600090565b6000818181116107fb57600080fd5b61081281662386f26fc1000063ffffffff6108be16565b33600090815260016020526040902054101561082d57600080fd5b6108356103cb565b158061084457506108446108ec565b156108825761086083662386f26fc1000063ffffffff6108be16565b3360009081526001602052604090208054829003905591506108828383610d59565b505050565b6000808383111561089757600080fd5b5050808203805b5092915050565b6000828201838110156108b757600080fd5b9392505050565b6000808315156108d1576000915061089e565b508282028284828115156108e157fe5b04146108b757600080fd5b600080600080600080600080600254815260200190815260200160002060010154600014156109755760028054600190810180835560408051608081018252600080825260208083018281528385018381524260608601908152968452918390529390912091518255915181850155905193810193909355516003909201919091559550610d51565b600280546000908152602081905260409020015415806109ab5750600280546000908152602081905260409020015460ff194301115b156109d057600280546000908152602081905260408120439201919091559550610d51565b60028054600090815260208190526040902001544314156109f45760009550610d51565b600280546000908152602081905260409020600181015491015440811515610a1857fe5b600254600081815260208181526040808320959094068083526004808701835285842054948452838352955485517f688abbf70000000000000000000000000000000000000000000000000000000081526001978101979097529451909a50600160a060020a03909316985092965073b3775fb83f7d12a36e0475abdd1fca35c091efbe9363688abbf793602480830194919391928390030190829087803b158015610ac357600080fd5b505af1158015610ad7573d6000803e3d6000fd5b505050506040513d6020811015610aed57600080fd5b505191506000821115610b7a5773b3775fb83f7d12a36e0475abdd1fca35c091efbe600160a060020a0316633ccfd60b6040518163ffffffff1660e060020a028152600401600060405180830381600087803b158015610b4c57600080fd5b505af1158015610b60573d6000803e3d6000fd5b50505050610b7782846108a590919063ffffffff16565b92505b6064610b8d84606163ffffffff6108be16565b811515610b9657fe5b600160a060020a0386166000908152600160205260409020549190049150610bc4908263ffffffff6108a516565b600160a060020a03851660008181526001602052604080822093909355915187928492917fff8ab71428121b903312f0811ef90ea93038df4601bb6c494a2f185b39c3eb3d9190a433600090815260016020526040902054610c2990606485046108a5565b3360008181526001602052604080822093909355915160648604927fbb205d8c6f31700f5a63510747931dab00a04fc866a0aa206da4bd1e6bd1580291a3610cd36064610c7d85600263ffffffff6108be16565b811515610c8657fe5b73f0ea6ce7d210ee58e83a463af13989b5c2dbe10860005260016020527f5eb8dbda94f21420a2724b33a34a9cf6a622e79d32940abc635fa4df803bb2585491900463ffffffff6108a516565b7f5eb8dbda94f21420a2724b33a34a9cf6a622e79d32940abc635fa4df803bb25855600280546001908101808355604080516080810182526000808252602082810182815283850183815242606086019081529684529183905293909120915182559151818501559051938101939093555160039092019190915595505b505050505090565b6002546000908152602081905260408120600101549080610d80858463ffffffff6108a516565b91508290505b81811015610dd0576002546000908152602081815260408083208484526004019091529020805473ffffffffffffffffffffffffffffffffffffffff191633179055600101610d86565b6002546000908152602081905260409020600101829055610e266064610dfd86603c63ffffffff6108be16565b811515610e0657fe5b60025460009081526020819052604090205491900463ffffffff6108a516565b6002805460009081526020818152604080832094909455915481528281203382526005019091522054610e5f908663ffffffff6108a516565b6002546000908152602081815260408083203380855260059091019092528083209390935591518792917fe11731cb4f1eb3ec3dd09bdc96809bb07365f4c881cda3192b397a4bc0b6da4091a373b3775fb83f7d12a36e0475abdd1fca35c091efbe63f088d5476064610ed987602863ffffffff6108be16565b811515610ee257fe5b04734fac33dabfd83d160717dfee4175d9caaa249ca56040518363ffffffff1660e060020a0281526004018082600160a060020a0316600160a060020a031681526020019150506020604051808303818588803b158015610f4257600080fd5b505af1158015610f56573d6000803e3d6000fd5b50505050506040513d6020811015610f6d57600080fd5b505050505050505600a165627a7a7230582064439cba06fda756fb68520fabd9c5440b76b6f73cc4e2c5d0fc04ad1c4fe9490029"
}