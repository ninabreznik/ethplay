{
  "address": "0xe46ce45a8691e8c131292aeb4bc3a4b8e3edc02e",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "ColuLocalCurrency",
  "compilerVersion": "v0.4.24+commit.e67f0147",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2018-05-27\n*/\n\npragma solidity ^0.4.18;\n\n// File: contracts/Ownable.sol\n\n/// @title Ownable\n/// @dev The Ownable contract has an owner address, and provides basic authorization control functions,\n/// this simplifies the implementation of \"user permissions\".\n/// @dev Based on OpenZeppelin's Ownable.\n\ncontract Ownable {\n    address public owner;\n    address public newOwnerCandidate;\n\n    event OwnershipRequested(address indexed by, address indexed to);\n    event OwnershipTransferred(address indexed from, address indexed to);\n\n    /// @dev Constructor sets the original `owner` of the contract to the sender account.\n    function Ownable() public {\n        owner = msg.sender;\n    }\n\n    /// @dev Reverts if called by any account other than the owner.\n    modifier onlyOwner() {\n        require(msg.sender == owner);\n        _;\n    }\n\n    modifier onlyOwnerCandidate() {\n        require(msg.sender == newOwnerCandidate);\n        _;\n    }\n\n    /// @dev Proposes to transfer control of the contract to a newOwnerCandidate.\n    /// @param _newOwnerCandidate address The address to transfer ownership to.\n    function requestOwnershipTransfer(address _newOwnerCandidate) external onlyOwner {\n        require(_newOwnerCandidate != address(0));\n\n        newOwnerCandidate = _newOwnerCandidate;\n\n        OwnershipRequested(msg.sender, newOwnerCandidate);\n    }\n\n    /// @dev Accept ownership transfer. This method needs to be called by the perviously proposed owner.\n    function acceptOwnership() external onlyOwnerCandidate {\n        address previousOwner = owner;\n\n        owner = newOwnerCandidate;\n        newOwnerCandidate = address(0);\n\n        OwnershipTransferred(previousOwner, owner);\n    }\n}\n\n// File: contracts/SafeMath.sol\n\n/// @title Math operations with safety checks\nlibrary SafeMath {\n    function mul(uint256 a, uint256 b) internal pure returns (uint256) {\n        uint256 c = a * b;\n        require(a == 0 || c / a == b);\n        return c;\n    }\n\n    function div(uint256 a, uint256 b) internal pure returns (uint256) {\n        // require(b > 0); // Solidity automatically throws when dividing by 0\n        uint256 c = a / b;\n        // require(a == b * c + a % b); // There is no case in which this doesn't hold\n        return c;\n    }\n\n    function sub(uint256 a, uint256 b) internal pure returns (uint256) {\n        require(b <= a);\n        return a - b;\n    }\n\n    function add(uint256 a, uint256 b) internal pure returns (uint256) {\n        uint256 c = a + b;\n        require(c >= a);\n        return c;\n    }\n\n    function max64(uint64 a, uint64 b) internal pure returns (uint64) {\n        return a >= b ? a : b;\n    }\n\n    function min64(uint64 a, uint64 b) internal pure returns (uint64) {\n        return a < b ? a : b;\n    }\n\n    function max256(uint256 a, uint256 b) internal pure returns (uint256) {\n        return a >= b ? a : b;\n    }\n\n    function min256(uint256 a, uint256 b) internal pure returns (uint256) {\n        return a < b ? a : b;\n    }\n\n    function toPower2(uint256 a) internal pure returns (uint256) {\n        return mul(a, a);\n    }\n\n    function sqrt(uint256 a) internal pure returns (uint256) {\n        uint256 c = (a + 1) / 2;\n        uint256 b = a;\n        while (c < b) {\n            b = c;\n            c = (a / c + c) / 2;\n        }\n        return b;\n    }\n}\n\n// File: contracts/ERC20.sol\n\n/// @title ERC Token Standard #20 Interface (https://github.com/ethereum/EIPs/issues/20)\ncontract ERC20 {\n    uint public totalSupply;\n    function balanceOf(address _owner) constant public returns (uint balance);\n    function transfer(address _to, uint _value) public returns (bool success);\n    function transferFrom(address _from, address _to, uint _value) public returns (bool success);\n    function approve(address _spender, uint _value) public returns (bool success);\n    function allowance(address _owner, address _spender) public constant returns (uint remaining);\n    event Transfer(address indexed from, address indexed to, uint value);\n    event Approval(address indexed owner, address indexed spender, uint value);\n}\n\n// File: contracts/BasicToken.sol\n\n/// @title Basic ERC20 token contract implementation.\n/// @dev Based on OpenZeppelin's StandardToken.\ncontract BasicToken is ERC20 {\n    using SafeMath for uint256;\n\n    uint256 public totalSupply;\n    mapping (address => mapping (address => uint256)) allowed;\n    mapping (address => uint256) balances;\n\n    event Approval(address indexed owner, address indexed spender, uint256 value);\n    event Transfer(address indexed from, address indexed to, uint256 value);\n\n    /// @dev Approve the passed address to spend the specified amount of tokens on behalf of msg.sender.\n    /// @param _spender address The address which will spend the funds.\n    /// @param _value uint256 The amount of tokens to be spent.\n    function approve(address _spender, uint256 _value) public returns (bool) {\n        // https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md#approve (see NOTE)\n        if ((_value != 0) && (allowed[msg.sender][_spender] != 0)) {\n            revert();\n        }\n\n        allowed[msg.sender][_spender] = _value;\n\n        Approval(msg.sender, _spender, _value);\n\n        return true;\n    }\n\n    /// @dev Function to check the amount of tokens that an owner allowed to a spender.\n    /// @param _owner address The address which owns the funds.\n    /// @param _spender address The address which will spend the funds.\n    /// @return uint256 specifying the amount of tokens still available for the spender.\n    function allowance(address _owner, address _spender) constant public returns (uint256 remaining) {\n        return allowed[_owner][_spender];\n    }\n\n\n    /// @dev Gets the balance of the specified address.\n    /// @param _owner address The address to query the the balance of.\n    /// @return uint256 representing the amount owned by the passed address.\n    function balanceOf(address _owner) constant public returns (uint256 balance) {\n        return balances[_owner];\n    }\n\n    /// @dev Transfer token to a specified address.\n    /// @param _to address The address to transfer to.\n    /// @param _value uint256 The amount to be transferred.\n    function transfer(address _to, uint256 _value) public returns (bool) {\n        require(_to != address(0));\n        balances[msg.sender] = balances[msg.sender].sub(_value);\n        balances[_to] = balances[_to].add(_value);\n\n        Transfer(msg.sender, _to, _value);\n\n        return true;\n    }\n\n    /// @dev Transfer tokens from one address to another.\n    /// @param _from address The address which you want to send tokens from.\n    /// @param _to address The address which you want to transfer to.\n    /// @param _value uint256 the amount of tokens to be transferred.\n    function transferFrom(address _from, address _to, uint256 _value) public returns (bool) {\n        require(_to != address(0));\n        uint256 _allowance = allowed[_from][msg.sender];\n\n        balances[_from] = balances[_from].sub(_value);\n        balances[_to] = balances[_to].add(_value);\n\n        allowed[_from][msg.sender] = _allowance.sub(_value);\n\n        Transfer(_from, _to, _value);\n\n        return true;\n    }\n}\n\n// File: contracts/ERC223Receiver.sol\n\n/// @title ERC223Receiver Interface\n/// @dev Based on the specs form: https://github.com/ethereum/EIPs/issues/223\ncontract ERC223Receiver {\n    function tokenFallback(address _sender, uint _value, bytes _data) external returns (bool ok);\n}\n\n// File: contracts/ERC677.sol\n\n/// @title ERC Token Standard #677 Interface (https://github.com/ethereum/EIPs/issues/677)\ncontract ERC677 is ERC20 {\n    function transferAndCall(address to, uint value, bytes data) public returns (bool ok);\n\n    event TransferAndCall(address indexed from, address indexed to, uint value, bytes data);\n}\n\n// File: contracts/Standard677Token.sol\n\n/// @title Standard677Token implentation, base on https://github.com/ethereum/EIPs/issues/677\n\ncontract Standard677Token is ERC677, BasicToken {\n\n  /// @dev ERC223 safe token transfer from one address to another\n  /// @param _to address the address which you want to transfer to.\n  /// @param _value uint256 the amount of tokens to be transferred.\n  /// @param _data bytes data that can be attached to the token transation\n  function transferAndCall(address _to, uint _value, bytes _data) public returns (bool) {\n    require(super.transfer(_to, _value)); // do a normal token transfer\n    TransferAndCall(msg.sender, _to, _value, _data);\n    //filtering if the target is a contract with bytecode inside it\n    if (isContract(_to)) return contractFallback(_to, _value, _data);\n    return true;\n  }\n\n  /// @dev called when transaction target is a contract\n  /// @param _to address the address which you want to transfer to.\n  /// @param _value uint256 the amount of tokens to be transferred.\n  /// @param _data bytes data that can be attached to the token transation\n  function contractFallback(address _to, uint _value, bytes _data) private returns (bool) {\n    ERC223Receiver receiver = ERC223Receiver(_to);\n    require(receiver.tokenFallback(msg.sender, _value, _data));\n    return true;\n  }\n\n  /// @dev check if the address is contract\n  /// assemble the given address bytecode. If bytecode exists then the _addr is a contract.\n  /// @param _addr address the address to check\n  function isContract(address _addr) private constant returns (bool is_contract) {\n    // retrieve the size of the code on target address, this needs assembly\n    uint length;\n    assembly { length := extcodesize(_addr) }\n    return length > 0;\n  }\n}\n\n// File: contracts/TokenHolder.sol\n\n/// @title Token holder contract.\ncontract TokenHolder is Ownable {\n    /// @dev Allow the owner to transfer out any accidentally sent ERC20 tokens.\n    /// @param _tokenAddress address The address of the ERC20 contract.\n    /// @param _amount uint256 The amount of tokens to be transferred.\n    function transferAnyERC20Token(address _tokenAddress, uint256 _amount) public onlyOwner returns (bool success) {\n        return ERC20(_tokenAddress).transfer(owner, _amount);\n    }\n}\n\n// File: contracts/ColuLocalCurrency.sol\n\n/// @title Colu Local Currency contract.\n/// @author Rotem Lev.\ncontract ColuLocalCurrency is Ownable, Standard677Token, TokenHolder {\n    using SafeMath for uint256;\n    string public name;\n    string public symbol;\n    uint8 public decimals;\n    string public tokenURI;\n\n    event TokenURIChanged(string newTokenURI);\n\n    /// @dev cotract to use when issuing a CC (Local Currency)\n    /// @param _name string name for CC token that is created.\n    /// @param _symbol string symbol for CC token that is created.\n    /// @param _decimals uint8 percison for CC token that is created.\n    /// @param _totalSupply uint256 total supply of the CC token that is created.\n    /// @param _tokenURI string the URI may point to a JSON file that conforms to the \"Metadata JSON Schema\".\n    function ColuLocalCurrency(string _name, string _symbol, uint8 _decimals, uint256 _totalSupply, string _tokenURI) public {\n        require(_totalSupply != 0);\n        require(bytes(_name).length != 0);\n        require(bytes(_symbol).length != 0);\n\n        totalSupply = _totalSupply;\n        name = _name;\n        symbol = _symbol;\n        decimals = _decimals;\n        tokenURI = _tokenURI;\n        balances[msg.sender] = totalSupply;\n    }\n\n    /// @dev Sets the tokenURI field, can be called by the owner only\n    /// @param _tokenURI string the URI may point to a JSON file that conforms to the \"Metadata JSON Schema\".\n    function setTokenURI(string _tokenURI) public onlyOwner {\n      tokenURI = _tokenURI;\n      TokenURIChanged(_tokenURI);\n    }\n}\n\n// File: contracts/Standard223Receiver.sol\n\n/// @title Standard ERC223 Token Receiver implementing tokenFallback function and tokenPayable modifier\n\ncontract Standard223Receiver is ERC223Receiver {\n  Tkn tkn;\n\n  struct Tkn {\n    address addr;\n    address sender; // the transaction caller\n    uint256 value;\n  }\n\n  bool __isTokenFallback;\n\n  modifier tokenPayable {\n    require(__isTokenFallback);\n    _;\n  }\n\n  /// @dev Called when the receiver of transfer is contract\n  /// @param _sender address the address of tokens sender\n  /// @param _value uint256 the amount of tokens to be transferred.\n  /// @param _data bytes data that can be attached to the token transation\n  function tokenFallback(address _sender, uint _value, bytes _data) external returns (bool ok) {\n    if (!supportsToken(msg.sender)) {\n      return false;\n    }\n\n    // Problem: This will do a sstore which is expensive gas wise. Find a way to keep it in memory.\n    // Solution: Remove the the data\n    tkn = Tkn(msg.sender, _sender, _value);\n    __isTokenFallback = true;\n    if (!address(this).delegatecall(_data)) {\n      __isTokenFallback = false;\n      return false;\n    }\n    // avoid doing an overwrite to .token, which would be more expensive\n    // makes accessing .tkn values outside tokenPayable functions unsafe\n    __isTokenFallback = false;\n\n    return true;\n  }\n\n  function supportsToken(address token) public constant returns (bool);\n}\n\n// File: contracts/TokenOwnable.sol\n\n/// @title TokenOwnable\n/// @dev The TokenOwnable contract adds a onlyTokenOwner modifier as a tokenReceiver with ownable addaptation\n\ncontract TokenOwnable is Standard223Receiver, Ownable {\n    /// @dev Reverts if called by any account other than the owner for token sending.\n    modifier onlyTokenOwner() {\n        require(tkn.sender == owner);\n        _;\n    }\n}\n\n// File: contracts/EllipseMarketMaker.sol\n\n/// @title Ellipse Market Maker contract.\n/// @dev market maker, using ellipse equation.\n/// @author Tal Beja.\ncontract EllipseMarketMaker is TokenOwnable {\n\n  // precision for price representation (as in ether or tokens).\n  uint256 public constant PRECISION = 10 ** 18;\n\n  // The tokens pair.\n  ERC20 public token1;\n  ERC20 public token2;\n\n  // The tokens reserves.\n  uint256 public R1;\n  uint256 public R2;\n\n  // The tokens full suplly.\n  uint256 public S1;\n  uint256 public S2;\n\n  // State flags.\n  bool public operational;\n  bool public openForPublic;\n\n  // Library contract address.\n  address public mmLib;\n\n  /// @dev Constructor calling the library contract using delegate.\n  function EllipseMarketMaker(address _mmLib, address _token1, address _token2) public {\n    require(_mmLib != address(0));\n    // Signature of the mmLib's constructor function\n    // bytes4 sig = bytes4(keccak256(\"constructor(address,address,address)\"));\n    bytes4 sig = 0x6dd23b5b;\n\n    // 3 arguments of size 32\n    uint256 argsSize = 3 * 32;\n    // sig + arguments size\n    uint256 dataSize = 4 + argsSize;\n\n\n    bytes memory m_data = new bytes(dataSize);\n\n    assembly {\n        // Add the signature first to memory\n        mstore(add(m_data, 0x20), sig)\n        // Add the parameters\n        mstore(add(m_data, 0x24), _mmLib)\n        mstore(add(m_data, 0x44), _token1)\n        mstore(add(m_data, 0x64), _token2)\n    }\n\n    // delegatecall to the library contract\n    require(_mmLib.delegatecall(m_data));\n  }\n\n  /// @dev returns true iff token is supperted by this contract (for erc223/677 tokens calls)\n  /// @param token can be token1 or token2\n  function supportsToken(address token) public constant returns (bool) {\n    return (token1 == token || token2 == token);\n  }\n\n  /// @dev gets called when no other function matches, delegate to the lib contract.\n  function() public {\n    address _mmLib = mmLib;\n    if (msg.data.length > 0) {\n      assembly {\n        calldatacopy(0xff, 0, calldatasize)\n        let retVal := delegatecall(gas, _mmLib, 0xff, calldatasize, 0, 0x20)\n        switch retVal case 0 { revert(0,0) } default { return(0, 0x20) }\n      }\n    }\n  }\n}\n\n// File: contracts/MarketMaker.sol\n\n/// @title Market Maker Interface.\n/// @author Tal Beja.\ncontract MarketMaker is ERC223Receiver {\n\n  function getCurrentPrice() public constant returns (uint _price);\n  function change(address _fromToken, uint _amount, address _toToken) public returns (uint _returnAmount);\n  function change(address _fromToken, uint _amount, address _toToken, uint _minReturn) public returns (uint _returnAmount);\n  function change(address _toToken) public returns (uint _returnAmount);\n  function change(address _toToken, uint _minReturn) public returns (uint _returnAmount);\n  function quote(address _fromToken, uint _amount, address _toToken) public constant returns (uint _returnAmount);\n  function openForPublicTrade() public returns (bool success);\n  function isOpenForPublic() public returns (bool success);\n\n  event Change(address indexed fromToken, uint inAmount, address indexed toToken, uint returnAmount, address indexed account);\n}\n\n// File: contracts/IEllipseMarketMaker.sol\n\n/// @title Ellipse Market Maker Interfase\n/// @author Tal Beja\ncontract IEllipseMarketMaker is MarketMaker {\n\n    // precision for price representation (as in ether or tokens).\n    uint256 public constant PRECISION = 10 ** 18;\n\n    // The tokens pair.\n    ERC20 public token1;\n    ERC20 public token2;\n\n    // The tokens reserves.\n    uint256 public R1;\n    uint256 public R2;\n\n    // The tokens full suplly.\n    uint256 public S1;\n    uint256 public S2;\n\n    // State flags.\n    bool public operational;\n    bool public openForPublic;\n\n    // Library contract address.\n    address public mmLib;\n\n    function supportsToken(address token) public constant returns (bool);\n\n    function calcReserve(uint256 _R1, uint256 _S1, uint256 _S2) public pure returns (uint256);\n\n    function validateReserves() public view returns (bool);\n\n    function withdrawExcessReserves() public returns (uint256);\n\n    function initializeAfterTransfer() public returns (bool);\n\n    function initializeOnTransfer() public returns (bool);\n\n    function getPrice(uint256 _R1, uint256 _R2, uint256 _S1, uint256 _S2) public constant returns (uint256);\n}\n\n// File: contracts/CurrencyFactory.sol\n\n/// @title Colu Local Currency + Market Maker factory contract.\n/// @author Rotem Lev.\ncontract CurrencyFactory is Standard223Receiver, TokenHolder {\n\n  struct CurrencyStruct {\n    string name;\n    uint8 decimals;\n    uint256 totalSupply;\n    address owner;\n    address mmAddress;\n  }\n\n\n  // map of Market Maker owners: token address => currency struct\n  mapping (address => CurrencyStruct) public currencyMap;\n  // address of the deployed CLN contract (ERC20 Token)\n  address public clnAddress;\n  // address of the deployed elipse market maker contract\n  address public mmLibAddress;\n\n  address[] public tokens;\n\n  event MarketOpen(address indexed marketMaker);\n  event TokenCreated(address indexed token, address indexed owner);\n\n  // modifier to check if called by issuer of the token\n  modifier tokenIssuerOnly(address token, address owner) {\n    require(currencyMap[token].owner == owner);\n    _;\n  }\n  // modifier to only accept transferAndCall from CLN token\n  modifier CLNOnly() {\n    require(msg.sender == clnAddress);\n    _;\n  }\n\n  /// @dev checks if the instance of market maker contract is closed for public\n  /// @param _token address address of the CC token.\n  modifier marketClosed(address _token) {\n  \trequire(!MarketMaker(currencyMap[_token].mmAddress).isOpenForPublic());\n  \t_;\n  }\n\n  /// @dev checks if the instance of market maker contract is open for public\n  /// @param _token address address of the CC token.\n  modifier marketOpen(address _token) {\n    require(MarketMaker(currencyMap[_token].mmAddress).isOpenForPublic());\n    _;\n  }\n\n  /// @dev constructor only reuires the address of the CLN token which must use the ERC20 interface\n  /// @param _mmLib address for the deployed market maker elipse contract\n  /// @param _clnAddress address for the deployed ERC20 CLN token\n  function CurrencyFactory(address _mmLib, address _clnAddress) public {\n  \trequire(_mmLib != address(0));\n  \trequire(_clnAddress != address(0));\n  \tmmLibAddress = _mmLib;\n  \tclnAddress = _clnAddress;\n  }\n\n  /// @dev create the MarketMaker and the CC token put all the CC token in the Market Maker reserve\n  /// @param _name string name for CC token that is created.\n  /// @param _symbol string symbol for CC token that is created.\n  /// @param _decimals uint8 percison for CC token that is created.\n  /// @param _totalSupply uint256 total supply of the CC token that is created.\n  /// @param _tokenURI string the URI may point to a JSON file that conforms to the \"Metadata JSON Schema\".\n  function createCurrency(string _name,\n                          string _symbol,\n                          uint8 _decimals,\n                          uint256 _totalSupply,\n                          string _tokenURI) public\n                          returns (address) {\n\n  \tColuLocalCurrency subToken = new ColuLocalCurrency(_name, _symbol, _decimals, _totalSupply, _tokenURI);\n  \tEllipseMarketMaker newMarketMaker = new EllipseMarketMaker(mmLibAddress, clnAddress, subToken);\n  \t//set allowance\n  \trequire(subToken.transfer(newMarketMaker, _totalSupply));\n  \trequire(IEllipseMarketMaker(newMarketMaker).initializeAfterTransfer());\n  \tcurrencyMap[subToken] = CurrencyStruct({ name: _name, decimals: _decimals, totalSupply: _totalSupply, mmAddress: newMarketMaker, owner: msg.sender});\n    tokens.push(subToken);\n  \tTokenCreated(subToken, msg.sender);\n  \treturn subToken;\n  }\n\n  /// @dev create the MarketMaker and the CC token put all the CC token in the Market Maker reserve\n  /// @param _name string name for CC token that is created.\n  /// @param _symbol string symbol for CC token that is created.\n  /// @param _decimals uint8 percison for CC token that is created.\n  /// @param _totalSupply uint256 total supply of the CC token that is created.\n  function createCurrency(string _name,\n                          string _symbol,\n                          uint8 _decimals,\n                          uint256 _totalSupply) public\n                          returns (address) {\n    return createCurrency(_name, _symbol, _decimals, _totalSupply, '');\n  }\n\n  /// @dev normal send cln to the market maker contract, sender must approve() before calling method. can only be called by owner\n  /// @dev sending CLN will return CC from the reserve to the sender.\n  /// @param _token address address of the cc token managed by this factory.\n  /// @param _clnAmount uint256 amount of CLN to transfer into the Market Maker reserve.\n  function insertCLNtoMarketMaker(address _token,\n                                  uint256 _clnAmount) public\n                                  tokenIssuerOnly(_token, msg.sender)\n                                  returns (uint256 _subTokenAmount) {\n  \trequire(_clnAmount > 0);\n  \taddress marketMakerAddress = getMarketMakerAddressFromToken(_token);\n  \trequire(ERC20(clnAddress).transferFrom(msg.sender, this, _clnAmount));\n  \trequire(ERC20(clnAddress).approve(marketMakerAddress, _clnAmount));\n  \t_subTokenAmount = IEllipseMarketMaker(marketMakerAddress).change(clnAddress, _clnAmount, _token);\n    require(ERC20(_token).transfer(msg.sender, _subTokenAmount));\n  }\n\n  /// @dev ERC223 transferAndCall, send cln to the market maker contract can only be called by owner (see MarketMaker)\n  /// @dev sending CLN will return CC from the reserve to the sender.\n  /// @param _token address address of the cc token managed by this factory.\n  function insertCLNtoMarketMaker(address _token) public\n                                  tokenPayable\n                                  CLNOnly\n                                  tokenIssuerOnly(_token, tkn.sender)\n                                  returns (uint256 _subTokenAmount) {\n  \taddress marketMakerAddress = getMarketMakerAddressFromToken(_token);\n  \trequire(ERC20(clnAddress).approve(marketMakerAddress, tkn.value));\n  \t_subTokenAmount = IEllipseMarketMaker(marketMakerAddress).change(clnAddress, tkn.value, _token);\n    require(ERC20(_token).transfer(tkn.sender, _subTokenAmount));\n  }\n\n  /// @dev normal send cc to the market maker contract, sender must approve() before calling method. can only be called by owner\n  /// @dev sending CC will return CLN from the reserve to the sender.\n  /// @param _token address address of the cc token managed by this factory.\n  /// @param _ccAmount uint256 amount of CC to transfer into the Market Maker reserve.\n  function extractCLNfromMarketMaker(address _token,\n                                     uint256 _ccAmount) public\n                                     tokenIssuerOnly(_token, msg.sender)\n                                     returns (uint256 _clnTokenAmount) {\n  \taddress marketMakerAddress = getMarketMakerAddressFromToken(_token);\n  \trequire(ERC20(_token).transferFrom(msg.sender, this, _ccAmount));\n  \trequire(ERC20(_token).approve(marketMakerAddress, _ccAmount));\n  \t_clnTokenAmount = IEllipseMarketMaker(marketMakerAddress).change(_token, _ccAmount, clnAddress);\n  \trequire(ERC20(clnAddress).transfer(msg.sender, _clnTokenAmount));\n  }\n\n  /// @dev ERC223 transferAndCall, send CC to the market maker contract can only be called by owner (see MarketMaker)\n  /// @dev sending CC will return CLN from the reserve to the sender.\n  function extractCLNfromMarketMaker() public\n                                    tokenPayable\n                                    tokenIssuerOnly(msg.sender, tkn.sender)\n                                    returns (uint256 _clnTokenAmount) {\n  \taddress marketMakerAddress = getMarketMakerAddressFromToken(msg.sender);\n  \trequire(ERC20(msg.sender).approve(marketMakerAddress, tkn.value));\n  \t_clnTokenAmount = IEllipseMarketMaker(marketMakerAddress).change(msg.sender, tkn.value, clnAddress);\n  \trequire(ERC20(clnAddress).transfer(tkn.sender, _clnTokenAmount));\n  }\n\n  /// @dev opens the Market Maker to recvice transactions from all sources.\n  /// @dev Request to transfer ownership of Market Maker contract to Owner instead of factory.\n  /// @param _token address address of the cc token managed by this factory.\n  function openMarket(address _token) public\n                      tokenIssuerOnly(_token, msg.sender)\n                      returns (bool) {\n  \taddress marketMakerAddress = getMarketMakerAddressFromToken(_token);\n  \trequire(MarketMaker(marketMakerAddress).openForPublicTrade());\n  \tOwnable(marketMakerAddress).requestOwnershipTransfer(msg.sender);\n    Ownable(_token).requestOwnershipTransfer(msg.sender);\n  \tMarketOpen(marketMakerAddress);\n  \treturn true;\n  }\n\n  /// @dev implementation for standard 223 reciver.\n  /// @param _token address of the token used with transferAndCall.\n  function supportsToken(address _token) public constant returns (bool) {\n  \treturn (clnAddress == _token || currencyMap[_token].totalSupply > 0);\n  }\n\n  /// @dev sets tokenURI for the given currency, can be used during the sell only\n  /// @param _token address address of the token to update\n  /// @param _tokenURI string the URI may point to a JSON file that conforms to the \"Metadata JSON Schema\".\n  function setTokenURI(address _token, string _tokenURI) public\n                              tokenIssuerOnly(_token, msg.sender)\n                              marketClosed(_token)\n                              returns (bool) {\n    ColuLocalCurrency(_token).setTokenURI(_tokenURI);\n    return true;\n  }\n\n  /// @dev helper function to get the market maker address form token\n  /// @param _token address of the token used with transferAndCall.\n  function getMarketMakerAddressFromToken(address _token) public constant returns (address _marketMakerAddress) {\n  \t_marketMakerAddress = currencyMap[_token].mmAddress;\n    require(_marketMakerAddress != address(0));\n  }\n}",
  "abi": "[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_newOwnerCandidate\",\"type\":\"address\"}],\"name\":\"requestOwnershipTransfer\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_spender\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"tokenURI\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"},{\"name\":\"_data\",\"type\":\"bytes\"}],\"name\":\"transferAndCall\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"balance\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"acceptOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"newOwnerCandidate\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_tokenAddress\",\"type\":\"address\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"transferAnyERC20Token\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"remaining\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_tokenURI\",\"type\":\"string\"}],\"name\":\"setTokenURI\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_name\",\"type\":\"string\"},{\"name\":\"_symbol\",\"type\":\"string\"},{\"name\":\"_decimals\",\"type\":\"uint8\"},{\"name\":\"_totalSupply\",\"type\":\"uint256\"},{\"name\":\"_tokenURI\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"newTokenURI\",\"type\":\"string\"}],\"name\":\"TokenURIChanged\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"by\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"}],\"name\":\"OwnershipRequested\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"data\",\"type\":\"bytes\"}],\"name\":\"TransferAndCall\",\"type\":\"event\"}]",
  "bytecode": "60806040523480156200001157600080fd5b5060405162000fc138038062000fc183398101604090815281516020830151918301516060840151608085015160048054600160a060020a03191633179055928501949384019391929091018115156200006a57600080fd5b845115156200007857600080fd5b835115156200008657600080fd5b60018290558451620000a0906006906020880190620000fb565b508351620000b6906007906020870190620000fb565b506008805460ff191660ff85161790558051620000db906009906020840190620000fb565b50506001543360009081526003602052604090205550620001a092505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200013e57805160ff19168380011785556200016e565b828001600101855582156200016e579182015b828111156200016e57825182559160200191906001019062000151565b506200017c92915062000180565b5090565b6200019d91905b808211156200017c576000815560010162000187565b90565b610e1180620001b06000396000f3006080604052600436106100f05763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166306fdde0381146100f55780630952c5041461017f578063095ea7b3146101a257806318160ddd146101da57806323b872dd14610201578063313ce5671461022b5780633c130d90146102565780634000aea01461026b57806370a08231146102d457806379ba5097146102f55780638da5cb5b1461030a57806395d89b411461033b578063a9059cbb14610350578063d091b55014610374578063dc39d06d14610389578063dd62ed3e146103ad578063e0df5b6f146103d4575b600080fd5b34801561010157600080fd5b5061010a61042d565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561014457818101518382015260200161012c565b50505050905090810190601f1680156101715780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561018b57600080fd5b506101a0600160a060020a03600435166104bb565b005b3480156101ae57600080fd5b506101c6600160a060020a0360043516602435610546565b604080519115158252519081900360200190f35b3480156101e657600080fd5b506101ef6105ea565b60408051918252519081900360200190f35b34801561020d57600080fd5b506101c6600160a060020a03600435811690602435166044356105f0565b34801561023757600080fd5b50610240610712565b6040805160ff9092168252519081900360200190f35b34801561026257600080fd5b5061010a61071b565b34801561027757600080fd5b50604080516020600460443581810135601f81018490048402850184019095528484526101c6948235600160a060020a03169460248035953695946064949201919081908401838280828437509497506107769650505050505050565b3480156102e057600080fd5b506101ef600160a060020a036004351661086d565b34801561030157600080fd5b506101a0610888565b34801561031657600080fd5b5061031f610910565b60408051600160a060020a039092168252519081900360200190f35b34801561034757600080fd5b5061010a61091f565b34801561035c57600080fd5b506101c6600160a060020a036004351660243561097a565b34801561038057600080fd5b5061031f610a41565b34801561039557600080fd5b506101c6600160a060020a0360043516602435610a50565b3480156103b957600080fd5b506101ef600160a060020a0360043581169060243516610b0d565b3480156103e057600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526101a0943694929360249392840191908190840183828082843750949750610b389650505050505050565b6006805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156104b35780601f10610488576101008083540402835291602001916104b3565b820191906000526020600020905b81548152906001019060200180831161049657829003601f168201915b505050505081565b600454600160a060020a031633146104d257600080fd5b600160a060020a03811615156104e757600080fd5b6005805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a03838116919091179182905560405191169033907f13a4b3bc0d5234dd3d87c9f1557d8faefa37986da62c36ba49309e2fb2c9aec490600090a350565b600081158015906105795750336000908152600260209081526040808320600160a060020a038716845290915290205415155b1561058357600080fd5b336000818152600260209081526040808320600160a060020a03881680855290835292819020869055805186815290519293927f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925929181900390910190a350600192915050565b60015481565b600080600160a060020a038416151561060857600080fd5b50600160a060020a03841660008181526002602090815260408083203384528252808320549383526003909152902054610648908463ffffffff610bff16565b600160a060020a03808716600090815260036020526040808220939093559086168152205461067d908463ffffffff610c1416565b600160a060020a0385166000908152600360205260409020556106a6818463ffffffff610bff16565b600160a060020a03808716600081815260026020908152604080832033845282529182902094909455805187815290519288169391927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef929181900390910190a3506001949350505050565b60085460ff1681565b6009805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156104b35780601f10610488576101008083540402835291602001916104b3565b6000610782848461097a565b151561078d57600080fd5b83600160a060020a031633600160a060020a03167fce8124fd2ae9fd7904103e5a9ebe88b527b9ca0e32a32fd497845c82706542d385856040518083815260200180602001828103825283818151815260200191508051906020019080838360005b838110156108075781810151838201526020016107ef565b50505050905090810190601f1680156108345780820380516001836020036101000a031916815260200191505b50935050505060405180910390a361084b84610c26565b156108625761085b848484610c2e565b9050610866565b5060015b9392505050565b600160a060020a031660009081526003602052604090205490565b600554600090600160a060020a031633146108a257600080fd5b50600480546005805473ffffffffffffffffffffffffffffffffffffffff19808416600160a060020a038381169190911795869055911690915560405191811692169082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a350565b600454600160a060020a031681565b6007805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156104b35780601f10610488576101008083540402835291602001916104b3565b6000600160a060020a038316151561099157600080fd5b336000908152600360205260409020546109b1908363ffffffff610bff16565b3360009081526003602052604080822092909255600160a060020a038516815220546109e3908363ffffffff610c1416565b600160a060020a0384166000818152600360209081526040918290209390935580518581529051919233927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9281900390910190a350600192915050565b600554600160a060020a031681565b600454600090600160a060020a03163314610a6a57600080fd5b60048054604080517fa9059cbb000000000000000000000000000000000000000000000000000000008152600160a060020a039283169381019390935260248301859052519085169163a9059cbb9160448083019260209291908290030181600087803b158015610ada57600080fd5b505af1158015610aee573d6000803e3d6000fd5b505050506040513d6020811015610b0457600080fd5b50519392505050565b600160a060020a03918216600090815260026020908152604080832093909416825291909152205490565b600454600160a060020a03163314610b4f57600080fd5b8051610b62906009906020840190610d4a565b507f2eb900bac6e5b21f659a14cf4e0b4a5689edb16947c549906436bc73b7053d16816040518080602001828103825283818151815260200191508051906020019080838360005b83811015610bc2578181015183820152602001610baa565b50505050905090810190601f168015610bef5780820380516001836020036101000a031916815260200191505b509250505060405180910390a150565b600082821115610c0e57600080fd5b50900390565b60008282018381101561086657600080fd5b6000903b1190565b6040517fc0ee0b8a0000000000000000000000000000000000000000000000000000000081523360048201818152602483018590526060604484019081528451606485015284516000948894600160a060020a0386169463c0ee0b8a9491938a938a939160849091019060208501908083838e5b83811015610cba578181015183820152602001610ca2565b50505050905090810190601f168015610ce75780820380516001836020036101000a031916815260200191505b50945050505050602060405180830381600087803b158015610d0857600080fd5b505af1158015610d1c573d6000803e3d6000fd5b505050506040513d6020811015610d3257600080fd5b50511515610d3f57600080fd5b506001949350505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610d8b57805160ff1916838001178555610db8565b82800160010185558215610db8579182015b82811115610db8578251825591602001919060010190610d9d565b50610dc4929150610dc8565b5090565b610de291905b80821115610dc45760008155600101610dce565b905600a165627a7a723058209639595b3309c99105a7c374771b79578020c23eb8380eebb58de8d750644913002900000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000031a17e847807b1bc0000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000d54656c204176697620436f696e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003544c5600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035697066733a2f2f516d573434763551344737627554755842564c615a46527977336d50395659656853485a393936663155447058750000000000000000000000",
  "constructorArguments": "00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000031a17e847807b1bc0000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000d54656c204176697620436f696e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003544c5600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035697066733a2f2f516d573434763551344737627554755842564c615a46527977336d50395659656853485a393936663155447058750000000000000000000000"
}