{
  "address": "0x51397c286a6399b4dd1fb8c221be94562d6951cb",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "QuantstampAuditTokenEscrow",
  "compilerVersion": "v0.4.25+commit.59dbf8f1",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2019-05-31\n*/\n\npragma solidity 0.4.25;\n\n// File: contracts/LinkedListLib.sol\n\n/**\n * @title LinkedListLib\n * @author Darryl Morris (o0ragman0o) and Modular.network\n *\n * This utility library was forked from https://github.com/o0ragman0o/LibCLL\n * into the Modular-Network ethereum-libraries repo at https://github.com/Modular-Network/ethereum-libraries\n * It has been updated to add additional functionality and be more compatible with solidity 0.4.18\n * coding patterns.\n *\n * version 1.1.1\n * Copyright (c) 2017 Modular Inc.\n * The MIT License (MIT)\n * https://github.com/Modular-network/ethereum-libraries/blob/master/LICENSE\n *\n * The LinkedListLib provides functionality for implementing data indexing using\n * a circlular linked list\n *\n * Modular provides smart contract services and security reviews for contract\n * deployments in addition to working on open source projects in the Ethereum\n * community. Our purpose is to test, document, and deploy reusable code onto the\n * blockchain and improve both security and usability. We also educate non-profits,\n * schools, and other community members about the application of blockchain\n * technology. For further information: modular.network\n *\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n\nlibrary LinkedListLib {\n\n    uint256 constant NULL = 0;\n    uint256 constant HEAD = 0;\n    bool constant PREV = false;\n    bool constant NEXT = true;\n\n    struct LinkedList{\n        mapping (uint256 => mapping (bool => uint256)) list;\n    }\n\n    /// @dev returns true if the list exists\n    /// @param self stored linked list from contract\n    function listExists(LinkedList storage self)\n        public\n        view returns (bool)\n    {\n        // if the head nodes previous or next pointers both point to itself, then there are no items in the list\n        if (self.list[HEAD][PREV] != HEAD || self.list[HEAD][NEXT] != HEAD) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    /// @dev returns true if the node exists\n    /// @param self stored linked list from contract\n    /// @param _node a node to search for\n    function nodeExists(LinkedList storage self, uint256 _node)\n        public\n        view returns (bool)\n    {\n        if (self.list[_node][PREV] == HEAD && self.list[_node][NEXT] == HEAD) {\n            if (self.list[HEAD][NEXT] == _node) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            return true;\n        }\n    }\n\n    /// @dev Returns the number of elements in the list\n    /// @param self stored linked list from contract\n    function sizeOf(LinkedList storage self) public view returns (uint256 numElements) {\n        bool exists;\n        uint256 i;\n        (exists,i) = getAdjacent(self, HEAD, NEXT);\n        while (i != HEAD) {\n            (exists,i) = getAdjacent(self, i, NEXT);\n            numElements++;\n        }\n        return;\n    }\n\n    /// @dev Returns the links of a node as a tuple\n    /// @param self stored linked list from contract\n    /// @param _node id of the node to get\n    function getNode(LinkedList storage self, uint256 _node)\n        public view returns (bool,uint256,uint256)\n    {\n        if (!nodeExists(self,_node)) {\n            return (false,0,0);\n        } else {\n            return (true,self.list[_node][PREV], self.list[_node][NEXT]);\n        }\n    }\n\n    /// @dev Returns the link of a node `_node` in direction `_direction`.\n    /// @param self stored linked list from contract\n    /// @param _node id of the node to step from\n    /// @param _direction direction to step in\n    function getAdjacent(LinkedList storage self, uint256 _node, bool _direction)\n        public view returns (bool,uint256)\n    {\n        if (!nodeExists(self,_node)) {\n            return (false,0);\n        } else {\n            return (true,self.list[_node][_direction]);\n        }\n    }\n\n    /// @dev Can be used before `insert` to build an ordered list\n    /// @param self stored linked list from contract\n    /// @param _node an existing node to search from, e.g. HEAD.\n    /// @param _value value to seek\n    /// @param _direction direction to seek in\n    //  @return next first node beyond '_node' in direction `_direction`\n    function getSortedSpot(LinkedList storage self, uint256 _node, uint256 _value, bool _direction)\n        public view returns (uint256)\n    {\n        if (sizeOf(self) == 0) { return 0; }\n        require((_node == 0) || nodeExists(self,_node));\n        bool exists;\n        uint256 next;\n        (exists,next) = getAdjacent(self, _node, _direction);\n        while  ((next != 0) && (_value != next) && ((_value < next) != _direction)) next = self.list[next][_direction];\n        return next;\n    }\n\n    /// @dev Creates a bidirectional link between two nodes on direction `_direction`\n    /// @param self stored linked list from contract\n    /// @param _node first node for linking\n    /// @param _link  node to link to in the _direction\n    function createLink(LinkedList storage self, uint256 _node, uint256 _link, bool _direction) private  {\n        self.list[_link][!_direction] = _node;\n        self.list[_node][_direction] = _link;\n    }\n\n    /// @dev Insert node `_new` beside existing node `_node` in direction `_direction`.\n    /// @param self stored linked list from contract\n    /// @param _node existing node\n    /// @param _new  new node to insert\n    /// @param _direction direction to insert node in\n    function insert(LinkedList storage self, uint256 _node, uint256 _new, bool _direction) internal returns (bool) {\n        if(!nodeExists(self,_new) && nodeExists(self,_node)) {\n            uint256 c = self.list[_node][_direction];\n            createLink(self, _node, _new, _direction);\n            createLink(self, _new, c, _direction);\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    /// @dev removes an entry from the linked list\n    /// @param self stored linked list from contract\n    /// @param _node node to remove from the list\n    function remove(LinkedList storage self, uint256 _node) internal returns (uint256) {\n        if ((_node == NULL) || (!nodeExists(self,_node))) { return 0; }\n        createLink(self, self.list[_node][PREV], self.list[_node][NEXT], NEXT);\n        delete self.list[_node][PREV];\n        delete self.list[_node][NEXT];\n        return _node;\n    }\n\n    /// @dev pushes an enrty to the head of the linked list\n    /// @param self stored linked list from contract\n    /// @param _node new entry to push to the head\n    /// @param _direction push to the head (NEXT) or tail (PREV)\n    function push(LinkedList storage self, uint256 _node, bool _direction) internal  {\n        insert(self, HEAD, _node, _direction);\n    }\n\n    /// @dev pops the first entry from the linked list\n    /// @param self stored linked list from contract\n    /// @param _direction pop from the head (NEXT) or the tail (PREV)\n    function pop(LinkedList storage self, bool _direction) internal returns (uint256) {\n        bool exists;\n        uint256 adj;\n\n        (exists,adj) = getAdjacent(self, HEAD, _direction);\n\n        return remove(self, adj);\n    }\n}\n\n// File: openzeppelin-solidity/contracts/math/SafeMath.sol\n\n/**\n * @title SafeMath\n * @dev Math operations with safety checks that throw on error\n */\nlibrary SafeMath {\n\n  /**\n  * @dev Multiplies two numbers, throws on overflow.\n  */\n  function mul(uint256 a, uint256 b) internal pure returns (uint256 c) {\n    // Gas optimization: this is cheaper than asserting 'a' not being zero, but the\n    // benefit is lost if 'b' is also tested.\n    // See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522\n    if (a == 0) {\n      return 0;\n    }\n\n    c = a * b;\n    assert(c / a == b);\n    return c;\n  }\n\n  /**\n  * @dev Integer division of two numbers, truncating the quotient.\n  */\n  function div(uint256 a, uint256 b) internal pure returns (uint256) {\n    // assert(b > 0); // Solidity automatically throws when dividing by 0\n    // uint256 c = a / b;\n    // assert(a == b * c + a % b); // There is no case in which this doesn't hold\n    return a / b;\n  }\n\n  /**\n  * @dev Subtracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).\n  */\n  function sub(uint256 a, uint256 b) internal pure returns (uint256) {\n    assert(b <= a);\n    return a - b;\n  }\n\n  /**\n  * @dev Adds two numbers, throws on overflow.\n  */\n  function add(uint256 a, uint256 b) internal pure returns (uint256 c) {\n    c = a + b;\n    assert(c >= a);\n    return c;\n  }\n}\n\n// File: openzeppelin-solidity/contracts/ownership/Ownable.sol\n\n/**\n * @title Ownable\n * @dev The Ownable contract has an owner address, and provides basic authorization control\n * functions, this simplifies the implementation of \"user permissions\".\n */\ncontract Ownable {\n  address public owner;\n\n\n  event OwnershipRenounced(address indexed previousOwner);\n  event OwnershipTransferred(\n    address indexed previousOwner,\n    address indexed newOwner\n  );\n\n\n  /**\n   * @dev The Ownable constructor sets the original `owner` of the contract to the sender\n   * account.\n   */\n  constructor() public {\n    owner = msg.sender;\n  }\n\n  /**\n   * @dev Throws if called by any account other than the owner.\n   */\n  modifier onlyOwner() {\n    require(msg.sender == owner);\n    _;\n  }\n\n  /**\n   * @dev Allows the current owner to relinquish control of the contract.\n   */\n  function renounceOwnership() public onlyOwner {\n    emit OwnershipRenounced(owner);\n    owner = address(0);\n  }\n\n  /**\n   * @dev Allows the current owner to transfer control of the contract to a newOwner.\n   * @param _newOwner The address to transfer ownership to.\n   */\n  function transferOwnership(address _newOwner) public onlyOwner {\n    _transferOwnership(_newOwner);\n  }\n\n  /**\n   * @dev Transfers control of the contract to a newOwner.\n   * @param _newOwner The address to transfer ownership to.\n   */\n  function _transferOwnership(address _newOwner) internal {\n    require(_newOwner != address(0));\n    emit OwnershipTransferred(owner, _newOwner);\n    owner = _newOwner;\n  }\n}\n\n// File: openzeppelin-solidity/contracts/ownership/rbac/Roles.sol\n\n/**\n * @title Roles\n * @author Francisco Giordano (@frangio)\n * @dev Library for managing addresses assigned to a Role.\n *      See RBAC.sol for example usage.\n */\nlibrary Roles {\n  struct Role {\n    mapping (address => bool) bearer;\n  }\n\n  /**\n   * @dev give an address access to this role\n   */\n  function add(Role storage role, address addr)\n    internal\n  {\n    role.bearer[addr] = true;\n  }\n\n  /**\n   * @dev remove an address' access to this role\n   */\n  function remove(Role storage role, address addr)\n    internal\n  {\n    role.bearer[addr] = false;\n  }\n\n  /**\n   * @dev check if an address has this role\n   * // reverts\n   */\n  function check(Role storage role, address addr)\n    view\n    internal\n  {\n    require(has(role, addr));\n  }\n\n  /**\n   * @dev check if an address has this role\n   * @return bool\n   */\n  function has(Role storage role, address addr)\n    view\n    internal\n    returns (bool)\n  {\n    return role.bearer[addr];\n  }\n}\n\n// File: openzeppelin-solidity/contracts/ownership/rbac/RBAC.sol\n\n/**\n * @title RBAC (Role-Based Access Control)\n * @author Matt Condon (@Shrugs)\n * @dev Stores and provides setters and getters for roles and addresses.\n * @dev Supports unlimited numbers of roles and addresses.\n * @dev See //contracts/mocks/RBACMock.sol for an example of usage.\n * This RBAC method uses strings to key roles. It may be beneficial\n *  for you to write your own implementation of this interface using Enums or similar.\n * It's also recommended that you define constants in the contract, like ROLE_ADMIN below,\n *  to avoid typos.\n */\ncontract RBAC {\n  using Roles for Roles.Role;\n\n  mapping (string => Roles.Role) private roles;\n\n  event RoleAdded(address addr, string roleName);\n  event RoleRemoved(address addr, string roleName);\n\n  /**\n   * @dev reverts if addr does not have role\n   * @param addr address\n   * @param roleName the name of the role\n   * // reverts\n   */\n  function checkRole(address addr, string roleName)\n    view\n    public\n  {\n    roles[roleName].check(addr);\n  }\n\n  /**\n   * @dev determine if addr has role\n   * @param addr address\n   * @param roleName the name of the role\n   * @return bool\n   */\n  function hasRole(address addr, string roleName)\n    view\n    public\n    returns (bool)\n  {\n    return roles[roleName].has(addr);\n  }\n\n  /**\n   * @dev add a role to an address\n   * @param addr address\n   * @param roleName the name of the role\n   */\n  function addRole(address addr, string roleName)\n    internal\n  {\n    roles[roleName].add(addr);\n    emit RoleAdded(addr, roleName);\n  }\n\n  /**\n   * @dev remove a role from an address\n   * @param addr address\n   * @param roleName the name of the role\n   */\n  function removeRole(address addr, string roleName)\n    internal\n  {\n    roles[roleName].remove(addr);\n    emit RoleRemoved(addr, roleName);\n  }\n\n  /**\n   * @dev modifier to scope access to a single role (uses msg.sender as addr)\n   * @param roleName the name of the role\n   * // reverts\n   */\n  modifier onlyRole(string roleName)\n  {\n    checkRole(msg.sender, roleName);\n    _;\n  }\n\n  /**\n   * @dev modifier to scope access to a set of roles (uses msg.sender as addr)\n   * @param roleNames the names of the roles to scope access to\n   * // reverts\n   *\n   * @TODO - when solidity supports dynamic arrays as arguments to modifiers, provide this\n   *  see: https://github.com/ethereum/solidity/issues/2467\n   */\n  // modifier onlyRoles(string[] roleNames) {\n  //     bool hasAnyRole = false;\n  //     for (uint8 i = 0; i < roleNames.length; i++) {\n  //         if (hasRole(msg.sender, roleNames[i])) {\n  //             hasAnyRole = true;\n  //             break;\n  //         }\n  //     }\n\n  //     require(hasAnyRole);\n\n  //     _;\n  // }\n}\n\n// File: openzeppelin-solidity/contracts/ownership/Whitelist.sol\n\n/**\n * @title Whitelist\n * @dev The Whitelist contract has a whitelist of addresses, and provides basic authorization control functions.\n * @dev This simplifies the implementation of \"user permissions\".\n */\ncontract Whitelist is Ownable, RBAC {\n  event WhitelistedAddressAdded(address addr);\n  event WhitelistedAddressRemoved(address addr);\n\n  string public constant ROLE_WHITELISTED = \"whitelist\";\n\n  /**\n   * @dev Throws if called by any account that's not whitelisted.\n   */\n  modifier onlyWhitelisted() {\n    checkRole(msg.sender, ROLE_WHITELISTED);\n    _;\n  }\n\n  /**\n   * @dev add an address to the whitelist\n   * @param addr address\n   * @return true if the address was added to the whitelist, false if the address was already in the whitelist\n   */\n  function addAddressToWhitelist(address addr)\n    onlyOwner\n    public\n  {\n    addRole(addr, ROLE_WHITELISTED);\n    emit WhitelistedAddressAdded(addr);\n  }\n\n  /**\n   * @dev getter to determine if address is in whitelist\n   */\n  function whitelist(address addr)\n    public\n    view\n    returns (bool)\n  {\n    return hasRole(addr, ROLE_WHITELISTED);\n  }\n\n  /**\n   * @dev add addresses to the whitelist\n   * @param addrs addresses\n   * @return true if at least one address was added to the whitelist,\n   * false if all addresses were already in the whitelist\n   */\n  function addAddressesToWhitelist(address[] addrs)\n    onlyOwner\n    public\n  {\n    for (uint256 i = 0; i < addrs.length; i++) {\n      addAddressToWhitelist(addrs[i]);\n    }\n  }\n\n  /**\n   * @dev remove an address from the whitelist\n   * @param addr address\n   * @return true if the address was removed from the whitelist,\n   * false if the address wasn't in the whitelist in the first place\n   */\n  function removeAddressFromWhitelist(address addr)\n    onlyOwner\n    public\n  {\n    removeRole(addr, ROLE_WHITELISTED);\n    emit WhitelistedAddressRemoved(addr);\n  }\n\n  /**\n   * @dev remove addresses from the whitelist\n   * @param addrs addresses\n   * @return true if at least one address was removed from the whitelist,\n   * false if all addresses weren't in the whitelist in the first place\n   */\n  function removeAddressesFromWhitelist(address[] addrs)\n    onlyOwner\n    public\n  {\n    for (uint256 i = 0; i < addrs.length; i++) {\n      removeAddressFromWhitelist(addrs[i]);\n    }\n  }\n\n}\n\n// File: openzeppelin-solidity/contracts/token/ERC20/ERC20Basic.sol\n\n/**\n * @title ERC20Basic\n * @dev Simpler version of ERC20 interface\n * @dev see https://github.com/ethereum/EIPs/issues/179\n */\ncontract ERC20Basic {\n  function totalSupply() public view returns (uint256);\n  function balanceOf(address who) public view returns (uint256);\n  function transfer(address to, uint256 value) public returns (bool);\n  event Transfer(address indexed from, address indexed to, uint256 value);\n}\n\n// File: openzeppelin-solidity/contracts/token/ERC20/ERC20.sol\n\n/**\n * @title ERC20 interface\n * @dev see https://github.com/ethereum/EIPs/issues/20\n */\ncontract ERC20 is ERC20Basic {\n  function allowance(address owner, address spender)\n    public view returns (uint256);\n\n  function transferFrom(address from, address to, uint256 value)\n    public returns (bool);\n\n  function approve(address spender, uint256 value) public returns (bool);\n  event Approval(\n    address indexed owner,\n    address indexed spender,\n    uint256 value\n  );\n}\n\n// File: openzeppelin-solidity/contracts/token/ERC20/SafeERC20.sol\n\n/**\n * @title SafeERC20\n * @dev Wrappers around ERC20 operations that throw on failure.\n * To use this library you can add a `using SafeERC20 for ERC20;` statement to your contract,\n * which allows you to call the safe operations as `token.safeTransfer(...)`, etc.\n */\nlibrary SafeERC20 {\n  function safeTransfer(ERC20Basic token, address to, uint256 value) internal {\n    require(token.transfer(to, value));\n  }\n\n  function safeTransferFrom(\n    ERC20 token,\n    address from,\n    address to,\n    uint256 value\n  )\n    internal\n  {\n    require(token.transferFrom(from, to, value));\n  }\n\n  function safeApprove(ERC20 token, address spender, uint256 value) internal {\n    require(token.approve(spender, value));\n  }\n}\n\n// File: contracts/token_escrow/TokenEscrow.sol\n\n/**\n * NOTE: All contracts in this directory were taken from a non-master branch of openzeppelin-solidity.\n * This contract was modified to be a whitelist.\n * Commit: ed451a8688d1fa7c927b27cec299a9726667d9b1\n */\n\npragma solidity ^0.4.24;\n\n\n\n\n\n\n/**\n * @title TokenEscrow\n * @dev Holds tokens destinated to a payee until they withdraw them.\n * The contract that uses the TokenEscrow as its payment method\n * should be its owner, and provide public methods redirecting\n * to the TokenEscrow's deposit and withdraw.\n * Moreover, the TokenEscrow should also be allowed to transfer\n * tokens from the payer to itself.\n */\ncontract TokenEscrow is Ownable, Whitelist {\n  using SafeMath for uint256;\n  using SafeERC20 for ERC20;\n\n  event Deposited(address indexed payee, uint256 tokenAmount);\n  event Withdrawn(address indexed payee, uint256 tokenAmount);\n\n  mapping(address => uint256) public deposits;\n\n  ERC20 public token;\n\n  constructor (ERC20 _token) public {\n    require(_token != address(0));\n    token = _token;\n  }\n\n  function depositsOf(address _payee) public view returns (uint256) {\n    return deposits[_payee];\n  }\n\n  /**\n  * @dev Puts in escrow a certain amount of tokens as credit to be withdrawn.\n  * @param _payee The destination address of the tokens.\n  * @param _amount The amount of tokens to deposit in escrow.\n  */\n  function deposit(address _payee, uint256 _amount) public onlyWhitelisted {\n    deposits[_payee] = deposits[_payee].add(_amount);\n\n    token.safeTransferFrom(msg.sender, address(this), _amount);\n\n    emit Deposited(_payee, _amount);\n  }\n\n  /**\n  * @dev Withdraw accumulated tokens for a payee.\n  * @param _payee The address whose tokens will be withdrawn and transferred to.\n  */\n  function withdraw(address _payee) public onlyWhitelisted {\n    uint256 payment = deposits[_payee];\n    assert(token.balanceOf(address(this)) >= payment);\n\n    deposits[_payee] = 0;\n\n    token.safeTransfer(_payee, payment);\n\n    emit Withdrawn(_payee, payment);\n  }\n}\n\n// File: contracts/token_escrow/ConditionalTokenEscrow.sol\n\n/**\n * NOTE: All contracts in this directory were taken from a non-master branch of openzeppelin-solidity.\n * Commit: ed451a8688d1fa7c927b27cec299a9726667d9b1\n */\n\npragma solidity ^0.4.24;\n\n\n\n/**\n * @title ConditionalTokenEscrow\n * @dev Base abstract escrow to only allow withdrawal of tokens\n * if a condition is met.\n */\ncontract ConditionalTokenEscrow is TokenEscrow {\n  /**\n  * @dev Returns whether an address is allowed to withdraw their tokens.\n  * To be implemented by derived contracts.\n  * @param _payee The destination address of the tokens.\n  */\n  function withdrawalAllowed(address _payee) public view returns (bool);\n\n  function withdraw(address _payee) public {\n    require(withdrawalAllowed(_payee));\n    super.withdraw(_payee);\n  }\n}\n\n// File: contracts/QuantstampAuditTokenEscrow.sol\n\ncontract QuantstampAuditTokenEscrow is ConditionalTokenEscrow {\n\n  // the escrow maintains the list of staked addresses\n  using LinkedListLib for LinkedListLib.LinkedList;\n\n  // constants used by LinkedListLib\n  uint256 constant internal NULL = 0;\n  uint256 constant internal HEAD = 0;\n  bool constant internal PREV = false;\n  bool constant internal NEXT = true;\n\n  // maintain the number of staked nodes\n  // saves gas cost over needing to call stakedNodesList.sizeOf()\n  uint256 public stakedNodesCount = 0;\n\n  // the minimum amount of wei-QSP that must be staked in order to be a node\n  uint256 public minAuditStake = 10000 * (10 ** 18);\n\n  // if true, the payee cannot currently withdraw their funds\n  mapping(address => bool) public lockedFunds;\n\n  // if funds are locked, they may be retrieved after this block\n  // if funds are unlocked, the number should be ignored\n  mapping(address => uint256) public unlockBlockNumber;\n\n  // staked audit nodes -- needed to inquire about audit node statistics, such as min price\n  // this list contains all nodes that have *ANY* stake, however when getNextStakedNode is called,\n  // it skips nodes that do not meet the minimum stake.\n  // the reason for this approach is that if the owner lowers the minAuditStake,\n  // we must be aware of any node with a stake.\n  LinkedListLib.LinkedList internal stakedNodesList;\n\n  event Slashed(address addr, uint256 amount);\n  event StakedNodeAdded(address addr);\n  event StakedNodeRemoved(address addr);\n\n  // the constructor of TokenEscrow requires an ERC20, not an address\n  constructor(address tokenAddress) public TokenEscrow(ERC20(tokenAddress)) {} // solhint-disable no-empty-blocks\n\n  /**\n  * @dev Puts in escrow a certain amount of tokens as credit to be withdrawn.\n  *      Overrides the function in TokenEscrow.sol to add the payee to the staked list.\n  * @param _payee The destination address of the tokens.\n  * @param _amount The amount of tokens to deposit in escrow.\n  */\n  function deposit(address _payee, uint256 _amount) public onlyWhitelisted {\n    super.deposit(_payee, _amount);\n    if (_amount > 0) {\n      // fails gracefully if the node already exists\n      addNodeToStakedList(_payee);\n    }\n  }\n\n /**\n  * @dev Withdraw accumulated tokens for a payee.\n  *      Overrides the function in TokenEscrow.sol to remove the payee from the staked list.\n  * @param _payee The address whose tokens will be withdrawn and transferred to.\n  */\n  function withdraw(address _payee) public onlyWhitelisted {\n    super.withdraw(_payee);\n    removeNodeFromStakedList(_payee);\n  }\n\n  /**\n   * @dev Sets the minimum stake to a new value.\n   * @param _value The new value. _value must be greater than zero in order for the linked list to be maintained correctly.\n   */\n  function setMinAuditStake(uint256 _value) public onlyOwner {\n    require(_value > 0);\n    minAuditStake = _value;\n  }\n\n  /**\n   * @dev Returns true if the sender staked enough.\n   * @param addr The address to check.\n   */\n  function hasEnoughStake(address addr) public view returns(bool) {\n    return depositsOf(addr) >= minAuditStake;\n  }\n\n  /**\n   * @dev Overrides ConditionalTokenEscrow function. If true, funds may be withdrawn.\n   * @param _payee The address that wants to withdraw funds.\n   */\n  function withdrawalAllowed(address _payee) public view returns (bool) {\n    return !lockedFunds[_payee] || unlockBlockNumber[_payee] < block.number;\n  }\n\n  /**\n   * @dev Prevents the payee from withdrawing funds.\n   * @param _payee The address that will be locked.\n   */\n  function lockFunds(address _payee, uint256 _unlockBlockNumber) public onlyWhitelisted returns (bool) {\n    lockedFunds[_payee] = true;\n    unlockBlockNumber[_payee] = _unlockBlockNumber;\n    return true;\n  }\n\n    /**\n   * @dev Slash a percentage of the stake of an address.\n   *      The percentage is taken from the minAuditStake, not the total stake of the address.\n   *      The caller of this function receives the slashed QSP.\n   *      If the current stake does not cover the slash amount, the full stake is taken.\n   *\n   * @param addr The address that will be slashed.\n   * @param percentage The percent of the minAuditStake that should be slashed.\n   */\n  function slash(address addr, uint256 percentage) public onlyWhitelisted returns (uint256) {\n    require(0 <= percentage && percentage <= 100);\n\n    uint256 slashAmount = getSlashAmount(percentage);\n    uint256 balance = depositsOf(addr);\n    if (balance < slashAmount) {\n      slashAmount = balance;\n    }\n\n    // subtract from the deposits amount of the addr\n    deposits[addr] = deposits[addr].sub(slashAmount);\n\n    emit Slashed(addr, slashAmount);\n\n    // if the deposits of the address are now zero, remove from the list\n    if (depositsOf(addr) == 0) {\n      removeNodeFromStakedList(addr);\n    }\n\n    // transfer the slashAmount to the police contract\n    token.safeTransfer(msg.sender, slashAmount);\n\n    return slashAmount;\n  }\n\n  /**\n   * @dev Returns the slash amount for a given percentage.\n   * @param percentage The percent of the minAuditStake that should be slashed.\n   */\n  function getSlashAmount(uint256 percentage) public view returns (uint256) {\n    return (minAuditStake.mul(percentage)).div(100);\n  }\n\n  /**\n   * @dev Given a staked address, returns the next address from the list that meets the minAuditStake.\n   * @param addr The staked address.\n   * @return The next address in the list.\n   */\n  function getNextStakedNode(address addr) public view returns(address) {\n    bool exists;\n    uint256 next;\n    (exists, next) = stakedNodesList.getAdjacent(uint256(addr), NEXT);\n    // only return addresses that meet the minAuditStake\n    while (exists && next != HEAD && !hasEnoughStake(address(next))) {\n      (exists, next) = stakedNodesList.getAdjacent(next, NEXT);\n    }\n    return address(next);\n  }\n\n  /**\n   * @dev Adds an address to the stakedNodesList.\n   * @param addr The address to be added to the list.\n   * @return true if the address was added to the list.\n   */\n  function addNodeToStakedList(address addr) internal returns(bool success) {\n    if (stakedNodesList.insert(HEAD, uint256(addr), PREV)) {\n      stakedNodesCount++;\n      emit StakedNodeAdded(addr);\n      success = true;\n    }\n  }\n\n  /**\n   * @dev Removes an address from the stakedNodesList.\n   * @param addr The address to be removed from the list.\n   * @return true if the address was removed from the list.\n   */\n  function removeNodeFromStakedList(address addr) internal returns(bool success) {\n    if (stakedNodesList.remove(uint256(addr)) != 0) {\n      stakedNodesCount--;\n      emit StakedNodeRemoved(addr);\n      success = true;\n    }\n  }\n}",
  "bytecode": "6080604052600060045569021e19e0c9bab240000060055534801561002357600080fd5b506040516020806118c7833981016040525160008054600160a060020a0319163317905580600160a060020a038116151561005d57600080fd5b60038054600160a060020a031916600160a060020a03929092169190911790555061183a8061008d6000396000f30060806040526004361061015e5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166302fb4d8581146101635780630988ca8c1461019957806312e382b41461020257806318b919e91461023a5780631b90b79a146102c4578063217fe6c6146102e557806324953eaa1461034c578063286dd3f5146103a15780632d5f1f61146103c257806347e7ef24146103da57806351cff8d9146103fe578063685ca1941461041f578063715018a61461044057806379735d54146104555780637b9417c8146104765780638da5cb5b146104975780639b19251a146104c8578063b6057719146104e9578063b86247d714610501578063c65c9d6314610522578063c7d1b09814610543578063cb50a60a14610558578063e2ec6ec31461056d578063e3a9db1a146105c2578063f2fde38b146105e3578063fc0c546a14610604578063fc7e286d14610619575b600080fd5b34801561016f57600080fd5b50610187600160a060020a036004351660243561063a565b60408051918252519081900360200190f35b3480156101a557600080fd5b5060408051602060046024803582810135601f8101859004850286018501909652858552610200958335600160a060020a031695369560449491939091019190819084018382808284375094975061076b9650505050505050565b005b34801561020e57600080fd5b50610226600160a060020a03600435166024356107d9565b604080519115158252519081900360200190f35b34801561024657600080fd5b5061024f610844565b6040805160208082528351818301528351919283929083019185019080838360005b83811015610289578181015183820152602001610271565b50505050905090810190601f1680156102b65780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156102d057600080fd5b50610187600160a060020a0360043516610869565b3480156102f157600080fd5b5060408051602060046024803582810135601f8101859004850286018501909652858552610226958335600160a060020a031695369560449491939091019190819084018382808284375094975061087b9650505050505050565b34801561035857600080fd5b5060408051602060048035808201358381028086018501909652808552610200953695939460249493850192918291850190849080828437509497506108ee9650505050505050565b3480156103ad57600080fd5b50610200600160a060020a036004351661093b565b3480156103ce57600080fd5b506101876004356109be565b3480156103e657600080fd5b50610200600160a060020a03600435166024356109ee565b34801561040a57600080fd5b50610200600160a060020a0360043516610a3c565b34801561042b57600080fd5b50610226600160a060020a0360043516610a7b565b34801561044c57600080fd5b50610200610abc565b34801561046157600080fd5b50610226600160a060020a0360043516610b28565b34801561048257600080fd5b50610200600160a060020a0360043516610b3e565b3480156104a357600080fd5b506104ac610bc1565b60408051600160a060020a039092168252519081900360200190f35b3480156104d457600080fd5b50610226600160a060020a0360043516610bd0565b3480156104f557600080fd5b50610200600435610bff565b34801561050d57600080fd5b50610226600160a060020a0360043516610c28565b34801561052e57600080fd5b506104ac600160a060020a0360043516610c3d565b34801561054f57600080fd5b50610187610dcf565b34801561056457600080fd5b50610187610dd5565b34801561057957600080fd5b506040805160206004803580820135838102808601850190965280855261020095369593946024949385019291829185019084908082843750949750610ddb9650505050505050565b3480156105ce57600080fd5b50610187600160a060020a0360043516610e28565b3480156105ef57600080fd5b50610200600160a060020a0360043516610e43565b34801561061057600080fd5b506104ac610e66565b34801561062557600080fd5b50610187600160a060020a0360043516610e75565b600080600061066c336040805190810160405280600981526020016000805160206117ef83398151915281525061076b565b8360001115801561067e575060648411155b151561068957600080fd5b610692846109be565b915061069d85610e28565b9050818110156106ab578091505b600160a060020a0385166000908152600260205260409020546106d4908363ffffffff610e8716565b600160a060020a03861660008181526002602090815260409182902093909355805191825291810184905281517f4ed05e9673c26d2ed44f7ef6a7f2942df0ee3b5e1e17db4b99f9dcd261a339cd929181900390910190a161073585610e28565b15156107465761074485610e99565b505b60035461076390600160a060020a0316338463ffffffff610f0816565b509392505050565b6107d5826001836040518082805190602001908083835b602083106107a15780518252601f199092019160209182019101610782565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922092915050610fbb565b5050565b6000610808336040805190810160405280600981526020016000805160206117ef83398151915281525061076b565b50600160a060020a0382166000908152600660209081526040808320805460ff1916600190811790915560079092529091208290555b92915050565b60408051808201909152600981526000805160206117ef833981519152602082015281565b60076020526000908152604090205481565b60006108e7836001846040518082805190602001908083835b602083106108b35780518252601f199092019160209182019101610894565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922092915050610fd0565b9392505050565b60008054600160a060020a0316331461090657600080fd5b5060005b81518110156107d557610933828281518110151561092457fe5b9060200190602002015161093b565b60010161090a565b600054600160a060020a0316331461095257600080fd5b61097f816040805190810160405280600981526020016000805160206117ef833981519152815250610fef565b60408051600160a060020a038316815290517ff1abf01a1043b7c244d128e8595cf0c1d10743b022b03a02dffd8ca3bf729f5a9181900360200190a150565b60006109e660646109da8460055461111090919063ffffffff16565b9063ffffffff61113916565b90505b919050565b610a1b336040805190810160405280600981526020016000805160206117ef83398151915281525061076b565b610a25828261114e565b60008111156107d557610a378261121a565b505050565b610a69336040805190810160405280600981526020016000805160206117ef83398151915281525061076b565b610a728161128a565b6107d581610e99565b600160a060020a03811660009081526006602052604081205460ff1615806109e6575050600160a060020a0316600090815260076020526040902054431190565b600054600160a060020a03163314610ad357600080fd5b60008054604051600160a060020a03909116917ff8df31144d9c2f0f6b59d69b8b98abd5459d07f2742c4df920b25aae33c6482091a26000805473ffffffffffffffffffffffffffffffffffffffff19169055565b6000600554610b3683610e28565b101592915050565b600054600160a060020a03163314610b5557600080fd5b610b82816040805190810160405280600981526020016000805160206117ef8339815191528152506112a7565b60408051600160a060020a038316815290517fd1bba68c128cc3f427e5831b3c6f99f480b6efa6b9e80c757768f6124158cc3f9181900360200190a150565b600054600160a060020a031681565b60006109e6826040805190810160405280600981526020016000805160206117ef83398151915281525061087b565b600054600160a060020a03163314610c1657600080fd5b60008111610c2357600080fd5b600555565b60066020526000908152604090205460ff1681565b604080517f574047ac00000000000000000000000000000000000000000000000000000000815260086004820152600160a060020a03831660248201526001604482015281516000928392839273697e2033ba28c1cc9e28d94ca910ca53a978aad09263574047ac9260648082019391829003018186803b158015610cc157600080fd5b505af4158015610cd5573d6000803e3d6000fd5b505050506040513d6040811015610ceb57600080fd5b50805160209091015190925090505b818015610d0657508015155b8015610d185750610d1681610b28565b155b156108e757604080517f574047ac000000000000000000000000000000000000000000000000000000008152600860048201526024810183905260016044820152815173697e2033ba28c1cc9e28d94ca910ca53a978aad09263574047ac9260648082019391829003018186803b158015610d9257600080fd5b505af4158015610da6573d6000803e3d6000fd5b505050506040513d6040811015610dbc57600080fd5b5080516020909101519092509050610cfa565b60055481565b60045481565b60008054600160a060020a03163314610df357600080fd5b5060005b81518110156107d557610e208282815181101515610e1157fe5b90602001906020020151610b3e565b600101610df7565b600160a060020a031660009081526002602052604090205490565b600054600160a060020a03163314610e5a57600080fd5b610e6381611388565b50565b600354600160a060020a031681565b60026020526000908152604090205481565b600082821115610e9357fe5b50900390565b6000610eb56008600160a060020a03841663ffffffff61140516565b156109e9576004805460001901905560408051600160a060020a038416815290517f0417b53ee0929247922f151d4e0092e802708250deebfde1546e001ad0f215619181900360200190a1506001919050565b82600160a060020a031663a9059cbb83836040518363ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018083600160a060020a0316600160a060020a0316815260200182815260200192505050602060405180830381600087803b158015610f8457600080fd5b505af1158015610f98573d6000803e3d6000fd5b505050506040513d6020811015610fae57600080fd5b50511515610a3757600080fd5b610fc58282610fd0565b15156107d557600080fd5b600160a060020a03166000908152602091909152604090205460ff1690565b611059826001836040518082805190602001908083835b602083106110255780518252601f199092019160209182019101611006565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922092915050611483565b7fd211483f91fc6eff862467f8de606587a30c8fc9981056f051b897a418df803a82826040518083600160a060020a0316600160a060020a0316815260200180602001828103825283818151815260200191508051906020019080838360005b838110156110d15781810151838201526020016110b9565b50505050905090810190601f1680156110fe5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15050565b60008215156111215750600061083e565b5081810281838281151561113157fe5b041461083e57fe5b6000818381151561114657fe5b049392505050565b61117b336040805190810160405280600981526020016000805160206117ef83398151915281525061076b565b600160a060020a0382166000908152600260205260409020546111a4908263ffffffff6114a516565b600160a060020a038084166000908152600260205260409020919091556003546111d7911633308463ffffffff6114b216565b604080518281529051600160a060020a038416917f2da466a7b24304f47e87fa2e1e5a81b9831ce54fec19055ce277ca2f39ba42c4919081900360200190a25050565b6000611238600882600160a060020a0385168163ffffffff61156316565b156109e95760048054600101905560408051600160a060020a038416815290517f5d0f0d30c09d7117fe7fec6cfbe93a96d1646cf7809feb6b4fc9663a755cf67a9181900360200190a1506001919050565b61129381610a7b565b151561129e57600080fd5b610e63816115d1565b611311826001836040518082805190602001908083835b602083106112dd5780518252601f1990920191602091820191016112be565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922092915050611720565b7fbfec83d64eaa953f2708271a023ab9ee82057f8f3578d548c1a4ba0b5b70048982826040518083600160a060020a0316600160a060020a031681526020018060200182810382528381815181526020019150805190602001908083836000838110156110d15781810151838201526020016110b9565b600160a060020a038116151561139d57600080fd5b60008054604051600160a060020a03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a36000805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055565b600081158061141b57506114198383611745565b155b156114285750600061083e565b60008281526020848152604080832083805290915280822054600180845291909220546114599286929091906117bd565b50600081815260209283526040808220828052909352828120819055600181529182209190915590565b600160a060020a0316600090815260209190915260409020805460ff19169055565b8181018281101561083e57fe5b604080517f23b872dd000000000000000000000000000000000000000000000000000000008152600160a060020a0385811660048301528481166024830152604482018490529151918616916323b872dd916064808201926020929091908290030181600087803b15801561152657600080fd5b505af115801561153a573d6000803e3d6000fd5b505050506040513d602081101561155057600080fd5b5051151561155d57600080fd5b50505050565b6000806115708685611745565b15801561158257506115828686611745565b156115c3575060008481526020868152604080832085151584529091529020546115ae868686866117bd565b6115ba868583866117bd565b600191506115c8565b600091505b50949350505050565b6000611600336040805190810160405280600981526020016000805160206117ef83398151915281525061076b565b50600160a060020a0380821660009081526002602090815260408083205460035482517f70a082310000000000000000000000000000000000000000000000000000000081523060048201529251919586959116936370a08231936024808201949293918390030190829087803b15801561167a57600080fd5b505af115801561168e573d6000803e3d6000fd5b505050506040513d60208110156116a457600080fd5b505110156116ae57fe5b600160a060020a038083166000908152600260205260408120556003546116dd9116838363ffffffff610f0816565b604080518281529051600160a060020a038416917f7084f5476618d8e60b11ef0d7d3f06914655adb8793e28ff7f018d4c76d505d5919081900360200190a25050565b600160a060020a0316600090815260209190915260409020805460ff19166001179055565b600081815260208381526040808320838052909152812054158015611780575060008281526020848152604080832060018452909152902054155b156117b557600080805260208481526040808320600184529091529020548214156117ad5750600161083e565b50600061083e565b50600161083e565b6000828152602085815260408083209315808452938252808320869055948252948552838120911581529352912055560077686974656c6973740000000000000000000000000000000000000000000000a165627a7a72305820af03876851d6691d43a118503e9fda84147ba6d56fc48897441fc114d6de8920002900000000000000000000000099ea4db9ee77acd40b119bd1dc4e33e1c070b80d",
  "constructorArguments": "00000000000000000000000099ea4db9ee77acd40b119bd1dc4e33e1c070b80d",
  "libraries": [
    {
      "name": "LinkedListLib",
      "address": "0x697E2033BA28C1cC9E28d94ca910cA53a978aaD0"
    }
  ]
}